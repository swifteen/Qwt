<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Qwt User&apos;s Guide: qwt_dyngrid_layout.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>qwt_dyngrid_layout.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* -*- mode: C++ ; c-file-style: "stroustrup" -*- *****************************</span>
00002 <span class="comment"> * Qwt Widget Library</span>
00003 <span class="comment"> * Copyright (C) 1997   Josef Wilgen</span>
00004 <span class="comment"> * Copyright (C) 2002   Uwe Rathmann</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
00007 <span class="comment"> * modify it under the terms of the Qwt License, Version 1.0</span>
00008 <span class="comment"> *****************************************************************************/</span>
00009 
00010 <span class="preprocessor">#include "qwt_dyngrid_layout.h"</span>
00011 
00012 <span class="preprocessor">#if QT_VERSION &gt;= 300</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#include &lt;qptrlist.h&gt;</span>
00014 <span class="preprocessor">#else</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#include &lt;qlist.h&gt;</span>
00016 <span class="preprocessor">#ifndef QPtrList</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#define QPtrList QList</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#define QPtrListIterator QListIterator</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00021 <span class="preprocessor"></span>
00022 <span class="keyword">class </span>QwtDynGridLayoutPrivate
00023 {
00024 <span class="keyword">public</span>:
00025     QwtDynGridLayoutPrivate():
00026         isDirty(TRUE)
00027     {
00028     }
00029 
00030     QPtrList&lt;QLayoutItem&gt; itemList;
00031 
00032     <span class="keywordtype">bool</span> isDirty;
00033     QwtArray&lt;QSize&gt; itemSizeHints;
00034 };
00035 
00036 <span class="keyword">class </span>QwtDynGridLayoutIterator: <span class="keyword">public</span> QGLayoutIterator
00037 {
00038 <span class="keyword">public</span>:
00039     QwtDynGridLayoutIterator(QwtDynGridLayoutPrivate *);
00040 
00041     <span class="keyword">virtual</span> QLayoutItem *current();
00042     <span class="keyword">virtual</span> QLayoutItem *next();
00043     <span class="keyword">virtual</span> QLayoutItem *takeCurrent();
00044 
00045 <span class="keyword">private</span>:
00046     QwtDynGridLayoutPrivate *d_data;
00047 };
00048 
00049 QwtDynGridLayoutIterator::QwtDynGridLayoutIterator(
00050         QwtDynGridLayoutPrivate *data):
00051     d_data(data)  
00052 {
00053     (void)d_data-&gt;itemList.first();
00054 }
00055 
00056 QLayoutItem *QwtDynGridLayoutIterator::current()
00057 { 
00058     <span class="keywordflow">return</span> d_data-&gt;itemList.current();
00059 }
00060 
00061 QLayoutItem *QwtDynGridLayoutIterator::next()
00062 { 
00063     <span class="keywordflow">return</span> d_data-&gt;itemList.next();
00064 }
00065 
00066 QLayoutItem *QwtDynGridLayoutIterator::takeCurrent()
00067 { 
00068     d_data-&gt;isDirty = TRUE;
00069     <span class="keywordflow">return</span> d_data-&gt;itemList.take(); 
00070 }
00071 
<a name="l00079"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a0">00079</a> <a class="code" href="class_qwt_dyn_grid_layout.html#a0">QwtDynGridLayout::QwtDynGridLayout</a>(QWidget *parent, 
00080         <span class="keywordtype">int</span> margin, <span class="keywordtype">int</span> space, <span class="keyword">const</span> <span class="keywordtype">char</span> *name):
00081     QLayout(parent, margin, space, name)
00082 {
00083     init();
00084 }
00085 
<a name="l00092"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a1">00092</a> <a class="code" href="class_qwt_dyn_grid_layout.html#a0">QwtDynGridLayout::QwtDynGridLayout</a>(QLayout *parent, 
00093         <span class="keywordtype">int</span> space, <span class="keyword">const</span> <span class="keywordtype">char</span> *name):
00094     QLayout(parent, space, name)
00095 {
00096     init();
00097 }
00098 
<a name="l00104"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a2">00104</a> <a class="code" href="class_qwt_dyn_grid_layout.html#a0">QwtDynGridLayout::QwtDynGridLayout</a>(<span class="keywordtype">int</span> space, <span class="keyword">const</span> <span class="keywordtype">char</span> *name):
00105     QLayout(space, name)
00106 {
00107     init();
00108 }
00109 
00113 <span class="keywordtype">void</span> QwtDynGridLayout::init()
00114 {
00115     d_layoutData = <span class="keyword">new</span> QwtDynGridLayoutPrivate;
00116     d_maxCols = d_numRows = d_numCols = 0;
00117     d_expanding = QSizePolicy::NoDirection;
00118 
00119     setSupportsMargin(TRUE);
00120 }
00121 
00123 
<a name="l00124"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a3">00124</a> <a class="code" href="class_qwt_dyn_grid_layout.html#a3">QwtDynGridLayout::~QwtDynGridLayout</a>()
00125 {
00126     deleteAllItems();
00127     <span class="keyword">delete</span> d_layoutData;
00128 }
00129 
00130 <span class="keywordtype">void</span> QwtDynGridLayout::invalidate()
00131 {
00132     d_layoutData-&gt;isDirty = TRUE;
00133     QLayout::invalidate();
00134 }
00135 
00136 <span class="keywordtype">void</span> QwtDynGridLayout::updateLayoutCache()
00137 {
00138     d_layoutData-&gt;itemSizeHints.resize(<a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>());
00139 
00140     <span class="keywordtype">int</span> index = 0;
00141 
00142     QPtrListIterator&lt;QLayoutItem&gt; it(d_layoutData-&gt;itemList);
00143     <span class="keywordflow">for</span> (<span class="keyword">const</span> QLayoutItem *item = it.toFirst(); item != 0;
00144         item = ++it, index++ )
00145     {
00146         d_layoutData-&gt;itemSizeHints[int(index)] = item-&gt;sizeHint();
00147     }
00148 
00149     d_layoutData-&gt;isDirty = FALSE;
00150 }
00151 
<a name="l00158"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a5">00158</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a5">QwtDynGridLayout::setMaxCols</a>(uint maxCols)
00159 {
00160     d_maxCols = maxCols;
00161 }
00162 
<a name="l00169"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a6">00169</a> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a6">QwtDynGridLayout::maxCols</a>()<span class="keyword"> const </span>
00170 <span class="keyword"></span>{ 
00171     <span class="keywordflow">return</span> d_maxCols; 
00172 }
00173 
00175 
<a name="l00176"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a9">00176</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a9">QwtDynGridLayout::addItem</a>(QLayoutItem *item)
00177 {
00178     d_layoutData-&gt;itemList.append(item);
00179     invalidate();
00180 }
00181 
<a name="l00186"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a18">00186</a> <span class="keywordtype">bool</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a18">QwtDynGridLayout::isEmpty</a>()<span class="keyword"> const</span>
00187 <span class="keyword"></span>{
00188     <span class="keywordflow">return</span> d_layoutData-&gt;itemList.isEmpty();
00189 }
00190 
<a name="l00195"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a19">00195</a> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a19">QwtDynGridLayout::itemCount</a>()<span class="keyword"> const</span>
00196 <span class="keyword"></span>{
00197     <span class="keywordflow">return</span> d_layoutData-&gt;itemList.count();
00198 }
00199 
<a name="l00204"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a10">00204</a> QLayoutIterator <a class="code" href="class_qwt_dyn_grid_layout.html#a10">QwtDynGridLayout::iterator</a>()
00205 {       
00206     <span class="keywordflow">return</span> QLayoutIterator( 
00207         <span class="keyword">new</span> QwtDynGridLayoutIterator(d_layoutData) );
00208 }
00209 
<a name="l00215"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a12">00215</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a12">QwtDynGridLayout::setGeometry</a>(<span class="keyword">const</span> QRect &amp;rect)
00216 {
00217     QLayout::setGeometry(rect);
00218 
00219     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00220         <span class="keywordflow">return</span>;
00221 
00222     d_numCols = <a class="code" href="class_qwt_dyn_grid_layout.html#a20">columnsForWidth</a>(rect.width());
00223     d_numRows = <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() / d_numCols;
00224     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() % d_numCols )
00225         d_numRows++;
00226 
00227     QValueList&lt;QRect&gt; itemGeometries = <a class="code" href="class_qwt_dyn_grid_layout.html#a21">layoutItems</a>(rect, d_numCols);
00228 
00229     <span class="keywordtype">int</span> index;
00230 
00231     QLayoutItem *item;
00232     QPtrListIterator&lt;QLayoutItem&gt; it(d_layoutData-&gt;itemList);
00233     <span class="keywordflow">for</span> ( index = 0, item = it.toFirst(); item != 0; item = ++it )
00234     {
00235         QWidget *w = item-&gt;widget();
00236         <span class="keywordflow">if</span> ( w )
00237         {
00238             w-&gt;setGeometry(itemGeometries[index]);
00239             index++;
00240         }
00241     }
00242 }
00243 
<a name="l00252"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a20">00252</a> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a20">QwtDynGridLayout::columnsForWidth</a>(<span class="keywordtype">int</span> width)<span class="keyword"> const</span>
00253 <span class="keyword"></span>{
00254     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00255         <span class="keywordflow">return</span> 0;
00256 
00257     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a6">maxCols</a> = (d_maxCols &gt; 0) ? d_maxCols : <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>();
00258     <span class="keywordflow">if</span> ( maxRowWidth(maxCols) &lt;= width )
00259         <span class="keywordflow">return</span> maxCols;
00260 
00261     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a8">numCols</a> = 2; numCols &lt;= maxCols; numCols++ )
00262     {
00263         <span class="keyword">const</span> <span class="keywordtype">int</span> rowWidth = maxRowWidth(numCols);
00264         <span class="keywordflow">if</span> ( rowWidth &gt; width )
00265             <span class="keywordflow">return</span> numCols - 1;
00266     }
00267 
00268     <span class="keywordflow">return</span> 1; <span class="comment">// At least 1 column</span>
00269 }
00270 
00278 <span class="keywordtype">int</span> QwtDynGridLayout::maxRowWidth(<span class="keywordtype">int</span> numCols)<span class="keyword"> const</span>
00279 <span class="keyword"></span>{
00280     <span class="keywordtype">int</span> col;
00281 
00282     QwtArray&lt;int&gt; colWidth(numCols);
00283     <span class="keywordflow">for</span> ( col = 0; col &lt; (int)numCols; col++ )
00284         colWidth[col] = 0;
00285 
00286     <span class="keywordflow">if</span> ( d_layoutData-&gt;isDirty )
00287         ((<a class="code" href="class_qwt_dyn_grid_layout.html">QwtDynGridLayout</a>*)<span class="keyword">this</span>)-&gt;updateLayoutCache();
00288 
00289     <span class="keywordflow">for</span> ( uint index = 0; 
00290         index &lt; d_layoutData-&gt;itemSizeHints.count(); index++ )
00291     {
00292         col = index % numCols;
00293         colWidth[col] = QMAX(colWidth[col], 
00294             d_layoutData-&gt;itemSizeHints[<span class="keywordtype">int</span>(index)].width());
00295     }
00296 
00297     <span class="keywordtype">int</span> rowWidth = 2 * margin() + (numCols - 1) * spacing();
00298     <span class="keywordflow">for</span> ( col = 0; col &lt; (int)numCols; col++ )
00299         rowWidth += colWidth[col];
00300 
00301     <span class="keywordflow">return</span> rowWidth;
00302 }
00303 
<a name="l00308"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a11">00308</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a11">QwtDynGridLayout::maxItemWidth</a>()<span class="keyword"> const</span>
00309 <span class="keyword"></span>{
00310     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00311         <span class="keywordflow">return</span> 0;
00312 
00313     <span class="keywordflow">if</span> ( d_layoutData-&gt;isDirty )
00314         ((<a class="code" href="class_qwt_dyn_grid_layout.html">QwtDynGridLayout</a>*)<span class="keyword">this</span>)-&gt;updateLayoutCache();
00315 
00316     <span class="keywordtype">int</span> w = 0;
00317     <span class="keywordflow">for</span> ( uint i = 0; i &lt; d_layoutData-&gt;itemSizeHints.count(); i++ )
00318     {
00319         <span class="keyword">const</span> <span class="keywordtype">int</span> itemW = d_layoutData-&gt;itemSizeHints[int(i)].width();
00320         <span class="keywordflow">if</span> ( itemW &gt; w )
00321             w = itemW;
00322     }
00323 
00324     <span class="keywordflow">return</span> w;
00325 }
00326 
<a name="l00335"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a21">00335</a> QValueList&lt;QRect&gt; <a class="code" href="class_qwt_dyn_grid_layout.html#a21">QwtDynGridLayout::layoutItems</a>(<span class="keyword">const</span> QRect &amp;rect,
00336     uint numCols)<span class="keyword"> const</span>
00337 <span class="keyword"></span>{
00338     QValueList&lt;QRect&gt; itemGeometries;
00339     <span class="keywordflow">if</span> ( numCols == 0 || <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00340         <span class="keywordflow">return</span> itemGeometries;
00341 
00342     uint <a class="code" href="class_qwt_dyn_grid_layout.html#a7">numRows</a> = <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() / numCols;
00343     <span class="keywordflow">if</span> ( numRows % <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() )
00344         numRows++;
00345  
00346     QwtArray&lt;int&gt; rowHeight(numRows);
00347     QwtArray&lt;int&gt; colWidth(numCols);
00348  
00349     <a class="code" href="class_qwt_dyn_grid_layout.html#b0">layoutGrid</a>(numCols, rowHeight, colWidth);
00350 
00351     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() != QSizePolicy::NoDirection )
00352         <a class="code" href="class_qwt_dyn_grid_layout.html#b1">stretchGrid</a>(rect, numCols, rowHeight, colWidth);
00353 
00354     <a class="code" href="class_qwt_dyn_grid_layout.html">QwtDynGridLayout</a> *that = (<a class="code" href="class_qwt_dyn_grid_layout.html">QwtDynGridLayout</a> *)<span class="keyword">this</span>;
00355     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a6">maxCols</a> = d_maxCols;
00356     that-&gt;<a class="code" href="class_qwt_dyn_grid_layout.html#r0">d_maxCols</a> = numCols;
00357     <span class="keyword">const</span> QRect alignedRect = alignmentRect(rect);
00358     that-&gt;<a class="code" href="class_qwt_dyn_grid_layout.html#r0">d_maxCols</a> = maxCols;
00359 
00360 <span class="preprocessor">#if QT_VERSION &lt; 300</span>
00361 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> xOffset = ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Horizontal ) 
00362         ? 0 : alignedRect.x();
00363     <span class="keyword">const</span> <span class="keywordtype">int</span> yOffset = ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Vertical ) 
00364         ? 0 : alignedRect.y();
00365 <span class="preprocessor">#else</span>
00366 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> xOffset = ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Horizontally ) 
00367         ? 0 : alignedRect.x();
00368     <span class="keyword">const</span> <span class="keywordtype">int</span> yOffset = ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Vertically ) 
00369         ? 0 : alignedRect.y();
00370 <span class="preprocessor">#endif</span>
00371 <span class="preprocessor"></span>
00372     QwtArray&lt;int&gt; colX(numCols);
00373     QwtArray&lt;int&gt; rowY(numRows);
00374 
00375     <span class="keyword">const</span> <span class="keywordtype">int</span> xySpace = spacing();
00376 
00377     rowY[0] = yOffset + margin();
00378     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> r = 1; r &lt; (int)numRows; r++ )
00379         rowY[r] = rowY[r-1] + rowHeight[r-1] + xySpace;
00380 
00381     colX[0] = xOffset + margin();
00382     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 1; c &lt; (int)numCols; c++ )
00383         colX[c] = colX[c-1] + colWidth[c-1] + xySpace;
00384     
00385     <span class="keywordtype">int</span> index;
00386     QLayoutItem *item;
00387 
00388     QPtrListIterator&lt;QLayoutItem&gt; it(d_layoutData-&gt;itemList);
00389     <span class="keywordflow">for</span> ( item = it.toFirst(), index = 0; item != 0; item = ++it, index++ )
00390     {
00391         <span class="keyword">const</span> <span class="keywordtype">int</span> row = index / numCols;
00392         <span class="keyword">const</span> <span class="keywordtype">int</span> col = index % numCols;
00393 
00394         QRect itemGeometry(colX[col], rowY[row], 
00395             colWidth[col], rowHeight[row]);
00396         itemGeometries.append(itemGeometry);
00397     }
00398 
00399     <span class="keywordflow">return</span> itemGeometries;
00400 }
00401 
00402 
<a name="l00411"></a><a class="code" href="class_qwt_dyn_grid_layout.html#b0">00411</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_dyn_grid_layout.html#b0">QwtDynGridLayout::layoutGrid</a>(uint numCols, 
00412     QwtArray&lt;int&gt;&amp; rowHeight, QwtArray&lt;int&gt;&amp; colWidth)<span class="keyword"> const</span>
00413 <span class="keyword"></span>{
00414     <span class="keywordflow">if</span> ( numCols &lt;= 0 )
00415         <span class="keywordflow">return</span>;
00416 
00417     <span class="keywordflow">if</span> ( d_layoutData-&gt;isDirty )
00418         ((<a class="code" href="class_qwt_dyn_grid_layout.html">QwtDynGridLayout</a>*)<span class="keyword">this</span>)-&gt;<a class="code" href="class_qwt_dyn_grid_layout.html#d2">updateLayoutCache</a>();
00419 
00420     <span class="keywordflow">for</span> ( uint index = 0; 
00421         index &lt; d_layoutData-&gt;itemSizeHints.count(); index++ )
00422     {
00423         <span class="keyword">const</span> <span class="keywordtype">int</span> row = index / numCols;
00424         <span class="keyword">const</span> <span class="keywordtype">int</span> col = index % numCols;
00425 
00426         <span class="keyword">const</span> QSize &amp;size = d_layoutData-&gt;itemSizeHints[int(index)];
00427 
00428         rowHeight[row] = (col == 0) 
00429             ? size.height() : QMAX(rowHeight[row], size.height());
00430         colWidth[col] = (row == 0) 
00431             ? size.width() : QMAX(colWidth[col], size.width());
00432     }
00433 }
00434 
<a name="l00443"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a16">00443</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a16">QwtDynGridLayout::setExpanding</a>(QSizePolicy::ExpandData expanding)
00444 {
00445     d_expanding = expanding;
00446 }
00447 
<a name="l00456"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a17">00456</a> QSizePolicy::ExpandData <a class="code" href="class_qwt_dyn_grid_layout.html#a17">QwtDynGridLayout::expanding</a>()<span class="keyword"> const</span>
00457 <span class="keyword"></span>{
00458     <span class="keywordflow">return</span> d_expanding;
00459 }
00460 
<a name="l00466"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a13">00466</a> <span class="keywordtype">bool</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a13">QwtDynGridLayout::hasHeightForWidth</a>()<span class="keyword"> const</span>
00467 <span class="keyword"></span>{
00468     <span class="keywordflow">return</span> TRUE;
00469 }
00470 
<a name="l00476"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a14">00476</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_dyn_grid_layout.html#a14">QwtDynGridLayout::heightForWidth</a>(<span class="keywordtype">int</span> width)<span class="keyword"> const</span>
00477 <span class="keyword"></span>{
00478     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00479         <span class="keywordflow">return</span> 0;
00480 
00481     <span class="keyword">const</span> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a8">numCols</a> = <a class="code" href="class_qwt_dyn_grid_layout.html#a20">columnsForWidth</a>(width);
00482     uint <a class="code" href="class_qwt_dyn_grid_layout.html#a7">numRows</a> = <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() / numCols;
00483     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() % numCols )
00484         numRows++;
00485 
00486     QwtArray&lt;int&gt; rowHeight(numRows);
00487     QwtArray&lt;int&gt; colWidth(numCols);
00488 
00489     <a class="code" href="class_qwt_dyn_grid_layout.html#b0">layoutGrid</a>(numCols, rowHeight, colWidth);
00490 
00491     <span class="keywordtype">int</span> h = 2 * margin() + (numRows - 1) * spacing();
00492     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> row = 0; row &lt; (int)numRows; row++ )
00493         h += rowHeight[row];
00494 
00495     <span class="keywordflow">return</span> h;
00496 }
00497 
<a name="l00505"></a><a class="code" href="class_qwt_dyn_grid_layout.html#b1">00505</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_dyn_grid_layout.html#b1">QwtDynGridLayout::stretchGrid</a>(<span class="keyword">const</span> QRect &amp;rect, 
00506     uint numCols, QwtArray&lt;int&gt;&amp; rowHeight, QwtArray&lt;int&gt;&amp; colWidth)<span class="keyword"> const</span>
00507 <span class="keyword"></span>{
00508     <span class="keywordflow">if</span> ( numCols == 0 || <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00509         <span class="keywordflow">return</span>;
00510 
00511 <span class="preprocessor">#if QT_VERSION &lt; 300</span>
00512 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Horizontal )
00513 <span class="preprocessor">#else</span>
00514 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Horizontally )
00515 <span class="preprocessor">#endif</span>
00516 <span class="preprocessor"></span>    {
00517         <span class="keywordtype">int</span> xDelta = rect.width() - 2 * margin() - (numCols - 1) * spacing();
00518         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> col = 0; col &lt; (int)numCols; col++ )
00519             xDelta -= colWidth[col];
00520 
00521         <span class="keywordflow">if</span> ( xDelta &gt; 0 )
00522         {
00523             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> col = 0; col &lt; (int)numCols; col++ )
00524             {
00525                 <span class="keyword">const</span> <span class="keywordtype">int</span> space = xDelta / (numCols - col);
00526                 colWidth[col] += space;
00527                 xDelta -= space;
00528             }
00529         }
00530     }
00531 
00532 <span class="preprocessor">#if QT_VERSION &lt; 300</span>
00533 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Vertical )
00534 <span class="preprocessor">#else</span>
00535 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a17">expanding</a>() &amp; QSizePolicy::Vertically )
00536 <span class="preprocessor">#endif</span>
00537 <span class="preprocessor"></span>    {
00538         uint <a class="code" href="class_qwt_dyn_grid_layout.html#a7">numRows</a> = <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() / numCols;
00539         <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() % numCols )
00540             numRows++;
00541 
00542         <span class="keywordtype">int</span> yDelta = rect.height() - 2 * margin() - (numRows - 1) * spacing();
00543         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> row = 0; row &lt; (int)numRows; row++ )
00544             yDelta -= rowHeight[row];
00545 
00546         <span class="keywordflow">if</span> ( yDelta &gt; 0 )
00547         {
00548             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> row = 0; row &lt; (int)numRows; row++ )
00549             {
00550                 <span class="keyword">const</span> <span class="keywordtype">int</span> space = yDelta / (numRows - row);
00551                 rowHeight[row] += space;
00552                 yDelta -= space;
00553             }
00554         }
00555     }
00556 }
00557 
<a name="l00565"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a15">00565</a> QSize <a class="code" href="class_qwt_dyn_grid_layout.html#a15">QwtDynGridLayout::sizeHint</a>()<span class="keyword"> const</span>
00566 <span class="keyword"></span>{
00567     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a18">isEmpty</a>() )
00568         <span class="keywordflow">return</span> QSize();
00569 
00570     <span class="keyword">const</span> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a8">numCols</a> = (d_maxCols &gt; 0 ) ? d_maxCols : <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>();
00571     uint <a class="code" href="class_qwt_dyn_grid_layout.html#a7">numRows</a> = <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() / numCols;
00572     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dyn_grid_layout.html#a19">itemCount</a>() % numCols )
00573         numRows++;
00574 
00575     QwtArray&lt;int&gt; rowHeight(numRows);
00576     QwtArray&lt;int&gt; colWidth(numCols);
00577 
00578     <a class="code" href="class_qwt_dyn_grid_layout.html#b0">layoutGrid</a>(numCols, rowHeight, colWidth);
00579 
00580     <span class="keywordtype">int</span> h = 2 * margin() + (numRows - 1) * spacing();
00581     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> row = 0; row &lt; (int)numRows; row++ )
00582         h += rowHeight[row];
00583 
00584     <span class="keywordtype">int</span> w = 2 * margin() + (numCols - 1) * spacing(); 
00585     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> col = 0; col &lt; (int)numCols; col++ )
00586         w += colWidth[col];
00587 
00588     <span class="keywordflow">return</span> QSize(w, h);
00589 }
00590 
<a name="l00596"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a7">00596</a> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a7">QwtDynGridLayout::numRows</a>()<span class="keyword"> const </span>
00597 <span class="keyword"></span>{ 
00598     <span class="keywordflow">return</span> d_numRows; 
00599 }
00600 
<a name="l00606"></a><a class="code" href="class_qwt_dyn_grid_layout.html#a8">00606</a> uint <a class="code" href="class_qwt_dyn_grid_layout.html#a8">QwtDynGridLayout::numCols</a>()<span class="keyword"> const </span>
00607 <span class="keyword"></span>{ 
00608     <span class="keywordflow">return</span> d_numCols; 
00609 }
00610 
00611 <span class="comment">// Local Variables:</span>
00612 <span class="comment">// mode: C++</span>
00613 <span class="comment">// c-file-style: "stroustrup"</span>
00614 <span class="comment">// indent-tabs-mode: nil</span>
00615 <span class="comment">// End:</span>
00616 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Nov 20 13:42:37 2004 for Qwt User's Guide by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
