<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Qwt User&apos;s Guide: qwt_scale.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>qwt_scale.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* -*- mode: C++ ; c-file-style: "stroustrup" -*- *****************************</span>
00002 <span class="comment"> * Qwt Widget Library</span>
00003 <span class="comment"> * Copyright (C) 1997   Josef Wilgen</span>
00004 <span class="comment"> * Copyright (C) 2002   Uwe Rathmann</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
00007 <span class="comment"> * modify it under the terms of the Qwt License, Version 1.0</span>
00008 <span class="comment"> *****************************************************************************/</span>
00009 
00010 <span class="comment">// vim: expandtab</span>
00011 
00012 <span class="preprocessor">#include &lt;qpainter.h&gt;</span>
00013 <span class="preprocessor">#include &lt;qevent.h&gt;</span>
00014 <span class="preprocessor">#include "qwt_painter.h"</span>
00015 <span class="preprocessor">#include "qwt_scale.h"</span>
00016 <span class="preprocessor">#include "<a class="code" href="qwt__math_8h.html">qwt_math.h</a>"</span>
00017 <span class="preprocessor">#include "qwt_paint_buffer.h"</span>
00018 <span class="preprocessor">#include "qwt_text.h"</span>
00019 
<a name="l00027"></a><a class="code" href="class_qwt_scale.html#a0">00027</a> <a class="code" href="class_qwt_scale.html#a0">QwtScale::QwtScale</a>(QWidget *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name):
00028     QWidget(parent, name, Qt::WRepaintNoErase|Qt::WResizeNoErase)
00029 {
00030     initScale(QwtScale::Left);
00031 }
00032 
<a name="l00041"></a><a class="code" href="class_qwt_scale.html#a1">00041</a> <a class="code" href="class_qwt_scale.html#a0">QwtScale::QwtScale</a>(QwtScale::Position pos, QWidget *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name):
00042     QWidget(parent,name, Qt::WRepaintNoErase|Qt::WResizeNoErase)
00043 {
00044     initScale(pos);
00045 }
00046 
<a name="l00048"></a><a class="code" href="class_qwt_scale.html#a2">00048</a> <a class="code" href="class_qwt_scale.html#a2">QwtScale::~QwtScale</a>()
00049 {
00050     <span class="keyword">delete</span> d_scaleDraw;
00051     <span class="keyword">delete</span> d_title;
00052 }
00053 
00055 <span class="keywordtype">void</span> QwtScale::initScale(QwtScale::Position pos)
00056 {
00057     QwtScaleDraw::Orientation sdo;
00058     d_borderDist[0] = 0;
00059     d_borderDist[1] = 0;
00060     d_baseDist = 4;
00061     d_titleOffset = 0;
00062     d_titleDist = 2;
00063 
00064     <span class="keywordflow">switch</span>(pos)
00065     {
00066         <span class="keywordflow">case</span> QwtScale::Left:
00067             sdo = QwtScaleDraw::Left;
00068             <span class="keywordflow">break</span>;
00069         <span class="keywordflow">case</span> QwtScale::Right:
00070             sdo = QwtScaleDraw::Right;
00071             <span class="keywordflow">break</span>;
00072         <span class="keywordflow">case</span> QwtScale::Bottom:
00073             sdo = QwtScaleDraw::Bottom;
00074             <span class="keywordflow">break</span>;
00075         <span class="keywordflow">case</span> QwtScale::Top:
00076             sdo = QwtScaleDraw::Top;
00077             <span class="keywordflow">break</span>;
00078         <span class="keywordflow">default</span>:
00079             sdo = QwtScaleDraw::Left;
00080     }
00081 
00082     d_scaleDraw = <span class="keyword">new</span> <a class="code" href="class_qwt_scale_draw.html">QwtScaleDraw</a>;
00083     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(0, 0, 10, sdo);
00084 
00085     d_title = <span class="keyword">new</span> <a class="code" href="class_qwt_plain_text.html">QwtPlainText</a>( QString::null, font(), 
00086                 Qt::AlignHCenter | Qt::WordBreak | Qt::ExpandTabs);
00087 }
00088 
<a name="l00094"></a><a class="code" href="class_qwt_scale.html#a3">00094</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a3">QwtScale::setTitle</a>(<span class="keyword">const</span> QString &amp;text)
00095 {
00096     <span class="keywordflow">if</span> (text == <a class="code" href="class_qwt_scale.html#a4">title</a>())
00097         <span class="keywordflow">return</span>;
00098 
00099     <a class="code" href="class_qwt_text.html">QwtText</a> *<a class="code" href="class_qwt_scale.html#a4">title</a> = <a class="code" href="class_qwt_text.html#e0">QwtText::makeText</a>(text, d_title-&gt;<a class="code" href="class_qwt_text.html#a9">alignment</a>(),
00100         d_title-&gt;<a class="code" href="class_qwt_text.html#a6">font</a>(), d_title-&gt;<a class="code" href="class_qwt_text.html#a11">color</a>());
00101 
00102     <span class="keyword">delete</span> d_title;
00103     d_title = title;
00104 
00105     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00106 }
00107 
<a name="l00113"></a><a class="code" href="class_qwt_scale.html#a32">00113</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a32">QwtScale::setPosition</a>(Position pos)
00114 {
00115     QwtScaleDraw::Orientation sdo;
00116     <span class="keywordflow">switch</span>(pos)
00117     {
00118         <span class="keywordflow">case</span> QwtScale::Left:
00119             sdo = QwtScaleDraw::Left;
00120             <span class="keywordflow">break</span>;
00121         <span class="keywordflow">case</span> QwtScale::Right:
00122             sdo = QwtScaleDraw::Right;
00123             <span class="keywordflow">break</span>;
00124         <span class="keywordflow">case</span> QwtScale::Bottom:
00125             sdo = QwtScaleDraw::Bottom;
00126             <span class="keywordflow">break</span>;
00127         <span class="keywordflow">case</span> QwtScale::Top:
00128             sdo = QwtScaleDraw::Top;
00129             <span class="keywordflow">break</span>;
00130         <span class="keywordflow">default</span>:
00131             sdo = QwtScaleDraw::Left;
00132     }
00133     
00134     <span class="keywordflow">if</span> (d_scaleDraw)
00135         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(0,0,10,sdo);
00136     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00137 }
00138 
00139         
<a name="l00144"></a><a class="code" href="class_qwt_scale.html#a33">00144</a> <a class="code" href="class_qwt_scale.html#w4">QwtScale::Position</a> <a class="code" href="class_qwt_scale.html#a33">QwtScale::position</a>()<span class="keyword"> const </span>
00145 <span class="keyword"></span>{
00146     <span class="keywordflow">if</span> (!<a class="code" href="class_qwt_scale.html#a21">scaleDraw</a>())
00147         <span class="keywordflow">return</span> Left;
00148     
00149     QwtScaleDraw::Orientation ori = <a class="code" href="class_qwt_scale.html#a21">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>();
00150     <span class="keywordflow">switch</span>(ori)
00151     {
00152         <span class="keywordflow">case</span> QwtScaleDraw::Left:
00153             <span class="keywordflow">return</span> QwtScale::Left;
00154         <span class="keywordflow">case</span> QwtScaleDraw::Right:
00155             <span class="keywordflow">return</span> QwtScale::Right;
00156         <span class="keywordflow">case</span> QwtScaleDraw::Bottom:
00157             <span class="keywordflow">return</span> QwtScale::Bottom;
00158         <span class="keywordflow">case</span> QwtScaleDraw::Top:
00159             <span class="keywordflow">return</span> QwtScale::Top;
00160         <span class="keywordflow">default</span>:
00161             <span class="keywordflow">return</span> QwtScale::Left;
00162     }
00163 }
00164 
<a name="l00173"></a><a class="code" href="class_qwt_scale.html#a11">00173</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a11">QwtScale::setBorderDist</a>(<span class="keywordtype">int</span> dist1, <span class="keywordtype">int</span> dist2)
00174 {
00175     <span class="keywordflow">if</span> ( dist1 != d_borderDist[0] || dist2 != d_borderDist[1] )
00176     {
00177         d_borderDist[0] = dist1;
00178         d_borderDist[1] = dist2;
00179         <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00180     }
00181 }
00182 
<a name="l00188"></a><a class="code" href="class_qwt_scale.html#a15">00188</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a15">QwtScale::setBaselineDist</a>(<span class="keywordtype">int</span> bd)
00189 {
00190     bd = qwtMax( 0, bd );
00191     <span class="keywordflow">if</span> ( bd != d_baseDist )
00192     {
00193         d_baseDist = bd;
00194         <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00195     }
00196 }
00197 
<a name="l00203"></a><a class="code" href="class_qwt_scale.html#a17">00203</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a17">QwtScale::setTitleDist</a>(<span class="keywordtype">int</span> td)
00204 {
00205     td = qwtMax( 0, td );
00206     <span class="keywordflow">if</span> ( td != d_titleDist )
00207     {
00208         d_titleDist = td;
00209         <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00210     }
00211 }
00212 
00213 
<a name="l00219"></a><a class="code" href="class_qwt_scale.html#a7">00219</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a7">QwtScale::setTitleFont</a>(<span class="keyword">const</span> QFont &amp;f)
00220 {
00221     <span class="keywordflow">if</span> (f == d_title-&gt;<a class="code" href="class_qwt_text.html#a6">font</a>())
00222         <span class="keywordflow">return</span>;
00223 
00224     d_title-&gt;<a class="code" href="class_qwt_text.html#a5">setFont</a>(f);
00225     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00226 }
00227 
<a name="l00233"></a><a class="code" href="class_qwt_scale.html#a5">00233</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a5">QwtScale::setTitleColor</a>(<span class="keyword">const</span> QColor &amp;c)
00234 {
00235     d_title-&gt;<a class="code" href="class_qwt_text.html#a10">setColor</a>(c);
00236     update();
00237 }
00238 
<a name="l00247"></a><a class="code" href="class_qwt_scale.html#a9">00247</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a9">QwtScale::setTitleAlignment</a>(<span class="keywordtype">int</span> flags)
00248 {
00249     flags &amp;= ~(Qt::AlignTop | Qt::AlignBottom);
00250     d_title-&gt;<a class="code" href="class_qwt_text.html#a8">setAlignment</a>(flags);
00251     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>(); <span class="comment">// Qt::SingleLine, Qt::ExpandTabs might affect layout</span>
00252 }
00253 
<a name="l00265"></a><a class="code" href="class_qwt_scale.html#a22">00265</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a22">QwtScale::setLabelFormat</a>(<span class="keywordtype">char</span> f, <span class="keywordtype">int</span> prec, <span class="keywordtype">int</span> fieldwidth)
00266 {
00267     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a12">setLabelFormat</a>(f, prec, fieldwidth);
00268     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00269 }
00270 
<a name="l00278"></a><a class="code" href="class_qwt_scale.html#a24">00278</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a24">QwtScale::setLabelAlignment</a>(<span class="keywordtype">int</span> align)
00279 {
00280     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a13">setLabelAlignment</a>(align);
00281     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00282 }
00283 
<a name="l00289"></a><a class="code" href="class_qwt_scale.html#a25">00289</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a25">QwtScale::setLabelRotation</a>(<span class="keywordtype">double</span> rotation)
00290 {
00291     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a14">setLabelRotation</a>(rotation);
00292     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00293 }
00294 
<a name="l00300"></a><a class="code" href="class_qwt_scale.html#a20">00300</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a20">QwtScale::setScaleDraw</a>(<a class="code" href="class_qwt_scale_draw.html">QwtScaleDraw</a> *sd)
00301 {
00302     <span class="keywordflow">if</span> ( sd == NULL || sd == d_scaleDraw )
00303         <span class="keywordflow">return</span>;
00304 
00305     <span class="keywordflow">if</span> ( d_scaleDraw )
00306         *sd = *d_scaleDraw;
00307 
00308     <span class="keyword">delete</span> d_scaleDraw;
00309     d_scaleDraw = sd;
00310 
00311     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00312 }
00313 
<a name="l00324"></a><a class="code" href="class_qwt_scale.html#a23">00324</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a23">QwtScale::labelFormat</a>(<span class="keywordtype">char</span> &amp;f, <span class="keywordtype">int</span> &amp;prec, <span class="keywordtype">int</span> &amp;fieldwidth)<span class="keyword"> const</span>
00325 <span class="keyword"></span>{
00326     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a24">labelFormat</a>(f, prec, fieldwidth);
00327 }
00328 
<a name="l00333"></a><a class="code" href="class_qwt_scale.html#a21">00333</a> <span class="keyword">const</span> <a class="code" href="class_qwt_scale_draw.html">QwtScaleDraw</a> *<a class="code" href="class_qwt_scale.html#a21">QwtScale::scaleDraw</a>()<span class="keyword"> const </span>
00334 <span class="keyword"></span>{ 
00335     <span class="keywordflow">return</span> d_scaleDraw; 
00336 }
00337 
<a name="l00342"></a><a class="code" href="class_qwt_scale.html#a10">00342</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a10">QwtScale::titleAlignment</a>()<span class="keyword"> const </span>
00343 <span class="keyword"></span>{ 
00344     <span class="keywordflow">return</span> d_title-&gt;<a class="code" href="class_qwt_text.html#a9">alignment</a>();
00345 }
00346 
<a name="l00351"></a><a class="code" href="class_qwt_scale.html#a8">00351</a> <span class="keyword">const</span> QFont <a class="code" href="class_qwt_scale.html#a8">QwtScale::titleFont</a>()<span class="keyword"> const </span>
00352 <span class="keyword"></span>{
00353     <span class="keywordflow">return</span> d_title-&gt;<a class="code" href="class_qwt_text.html#a6">font</a>();
00354 }
00355 
<a name="l00360"></a><a class="code" href="class_qwt_scale.html#a6">00360</a> <span class="keyword">const</span> QColor <a class="code" href="class_qwt_scale.html#a6">QwtScale::titleColor</a>()<span class="keyword"> const </span>
00361 <span class="keyword"></span>{
00362     <span class="keywordflow">return</span> d_title-&gt;<a class="code" href="class_qwt_text.html#a11">color</a>();
00363 }
00364 
<a name="l00369"></a><a class="code" href="class_qwt_scale.html#a4">00369</a> <span class="keyword">const</span> QString <a class="code" href="class_qwt_scale.html#a4">QwtScale::title</a>()<span class="keyword"> const </span>
00370 <span class="keyword"></span>{
00371     <span class="keywordflow">return</span> d_title-&gt;<a class="code" href="class_qwt_text.html#a2">text</a>();
00372 }
00373 
<a name="l00378"></a><a class="code" href="class_qwt_scale.html#a12">00378</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a12">QwtScale::startBorderDist</a>()<span class="keyword"> const </span>
00379 <span class="keyword"></span>{ 
00380     <span class="keywordflow">return</span> d_borderDist[0]; 
00381 }  
00382 
<a name="l00387"></a><a class="code" href="class_qwt_scale.html#a13">00387</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a13">QwtScale::endBorderDist</a>()<span class="keyword"> const </span>
00388 <span class="keyword"></span>{ 
00389     <span class="keywordflow">return</span> d_borderDist[1]; 
00390 }
00391 
<a name="l00396"></a><a class="code" href="class_qwt_scale.html#a16">00396</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a16">QwtScale::baseLineDist</a>()<span class="keyword"> const </span>
00397 <span class="keyword"></span>{ 
00398     <span class="keywordflow">return</span> d_baseDist; 
00399 }
00400 
<a name="l00405"></a><a class="code" href="class_qwt_scale.html#a18">00405</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a18">QwtScale::titleDist</a>()<span class="keyword"> const </span>
00406 <span class="keyword"></span>{ 
00407     <span class="keywordflow">return</span> d_titleDist; 
00408 }
00409 
<a name="l00413"></a><a class="code" href="class_qwt_scale.html#b1">00413</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#b1">QwtScale::paintEvent</a>(QPaintEvent *e)
00414 {
00415     <span class="keyword">const</span> QRect &amp;ur = e-&gt;rect();
00416     <span class="keywordflow">if</span> ( ur.isValid() )
00417     {
00418         <a class="code" href="class_qwt_paint_buffer.html">QwtPaintBuffer</a> paintBuffer(<span class="keyword">this</span>, ur);
00419         <a class="code" href="class_qwt_scale.html#b0">draw</a>(paintBuffer.<a class="code" href="class_qwt_paint_buffer.html#a5">painter</a>());
00420     }
00421 }
00422 
<a name="l00426"></a><a class="code" href="class_qwt_scale.html#b0">00426</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#b0">QwtScale::draw</a>(QPainter *p)<span class="keyword"> const</span>
00427 <span class="keyword"></span>{
00428     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a29">draw</a>(p);
00429 
00430     QRect r = rect();
00431 
00432     <span class="keywordflow">switch</span>(d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>())
00433     {
00434         <span class="keywordflow">case</span> QwtScaleDraw::Bottom:
00435             r.setTop( r.top() + d_titleOffset );
00436             <span class="keywordflow">break</span>;
00437 
00438         <span class="keywordflow">case</span> QwtScaleDraw::Left:
00439             r.setRight( r.right() - d_titleOffset );
00440             <span class="keywordflow">break</span>;
00441 
00442         <span class="keywordflow">case</span> QwtScaleDraw::Right:
00443             r.setLeft( r.left() + d_titleOffset );
00444             <span class="keywordflow">break</span>;
00445 
00446         <span class="keywordflow">case</span> QwtScaleDraw::Top:
00447         <span class="keywordflow">default</span>:
00448             r.setBottom( r.bottom() - d_titleOffset );
00449             <span class="keywordflow">break</span>;
00450     }
00451 
00452     <a class="code" href="class_qwt_scale.html#a31">drawTitle</a>(p, d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>(), r);
00453 }
00454 
<a name="l00458"></a><a class="code" href="class_qwt_scale.html#b2">00458</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#b2">QwtScale::resizeEvent</a>(QResizeEvent *)
00459 {
00460     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>(FALSE);
00461 }
00462 
00464 <span class="comment">//  the current rect and fonts.</span>
00465 <span class="comment">//  \param update_geometry   notify the layout system and call update</span>
00466 <span class="comment">//         to redraw the scale</span>
00467 
<a name="l00468"></a><a class="code" href="class_qwt_scale.html#b5">00468</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#b5">QwtScale::layoutScale</a>( <span class="keywordtype">bool</span> update_geometry )
00469 {
00470     QRect r = this-&gt;rect();
00471 
00472     <span class="comment">// Borders cannot be less than the minBorderDist</span>
00473 
00474     <span class="keywordtype">int</span> bd0, bd1;
00475     <a class="code" href="class_qwt_scale.html#a14">minBorderDist</a>(bd0, bd1);
00476     <span class="keywordflow">if</span> ( d_borderDist[0] &gt; bd0 )
00477         bd0 = d_borderDist[0];
00478     <span class="keywordflow">if</span> ( d_borderDist[1] &gt; bd1 )
00479         bd1 = d_borderDist[1];
00480 
00481     <span class="keyword">const</span> QFontMetrics fm(font());
00482     <span class="keywordflow">switch</span>(d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>())
00483     {
00484     <span class="keywordflow">case</span> QwtScaleDraw::Bottom:
00485         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(r.x() + bd0, r.y() + d_baseDist,
00486             r.width() - bd0 - bd1, QwtScaleDraw::Bottom);
00487 
00488         d_titleOffset = d_titleDist + d_baseDist +
00489             d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a19">maxHeight</a>(QPen(), fm);
00490         <span class="keywordflow">break</span>;
00491 
00492     <span class="keywordflow">case</span> QwtScaleDraw::Top:
00493         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(r.x() + bd0, r.bottom() - d_baseDist,
00494                r.width() - bd0 - bd1, QwtScaleDraw::Top);
00495         d_titleOffset =  d_titleDist + d_baseDist +
00496                            d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a19">maxHeight</a>(QPen(), fm);
00497         <span class="keywordflow">break</span>;
00498 
00499     <span class="keywordflow">case</span> QwtScaleDraw::Left:
00500         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(r.right() - d_baseDist, r.y() + bd0,
00501                             r.height() - bd0 - bd1, QwtScaleDraw::Left);
00502         d_titleOffset = d_baseDist + d_titleDist +
00503                         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a18">maxWidth</a>(QPen(), fm);
00504         <span class="keywordflow">break</span>;
00505 
00506     <span class="keywordflow">case</span> QwtScaleDraw::Right:
00507         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(r.x() + d_baseDist, r.y() + bd0,
00508                             r.height() - bd0 - bd1, QwtScaleDraw::Right);
00509         d_titleOffset = d_baseDist + d_titleDist +
00510                           d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a18">maxWidth</a>(QPen(), fm);
00511         <span class="keywordflow">break</span>;
00512     <span class="keywordflow">default</span>:
00513         <span class="keywordflow">break</span>;
00514     }
00515     <span class="keywordflow">if</span> ( update_geometry )
00516     {
00517       updateGeometry();
00518       update();
00519     }
00520 }
00521 
<a name="l00529"></a><a class="code" href="class_qwt_scale.html#a31">00529</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a31">QwtScale::drawTitle</a>(QPainter *painter,
00530     QwtScaleDraw::Orientation o, <span class="keyword">const</span> QRect &amp;rect)<span class="keyword"> const</span>
00531 <span class="keyword"></span>{
00532     QRect r;
00533     <span class="keywordtype">double</span> angle;
00534     <span class="keywordtype">int</span> align = d_title-&gt;<a class="code" href="class_qwt_text.html#a9">alignment</a>() &amp; ~(Qt::AlignTop | Qt::AlignBottom);
00535 
00536     <span class="keywordflow">switch</span>(o)
00537     {
00538 <span class="preprocessor">#ifndef QT_NO_TRANSFORMATIONS</span>
00539 <span class="preprocessor"></span>        <span class="keywordflow">case</span> QwtScaleDraw::Left:
00540             align |= Qt::AlignTop;
00541             angle = -90.0;
00542             r.setRect(rect.left(), rect.bottom(), rect.height(), rect.width());
00543             <span class="keywordflow">break</span>;
00544         <span class="keywordflow">case</span> QwtScaleDraw::Right:
00545             align |= Qt::AlignTop;
00546             angle = 90.0;
00547             r.setRect(rect.right(), rect.top(), rect.height(), rect.width());
00548             <span class="keywordflow">break</span>;
00549 <span class="preprocessor">#else</span>
00550 <span class="preprocessor"></span>        <span class="keywordflow">case</span> QwtScaleDraw::Left:
00551         <span class="keywordflow">case</span> QwtScaleDraw::Right:
00552             <span class="comment">// swallow vertical titles</span>
00553             <span class="keywordflow">return</span>;
00554 <span class="preprocessor">#endif</span>
00555 <span class="preprocessor"></span>        <span class="keywordflow">case</span> QwtScaleDraw::Top:
00556             align |= Qt::AlignTop;
00557             angle = 0.0;
00558             r = rect;
00559             <span class="keywordflow">break</span>;
00560         <span class="keywordflow">case</span> QwtScaleDraw::Bottom:
00561         <span class="keywordflow">default</span>:
00562             align |= Qt::AlignBottom;
00563             angle = 0.0;
00564             r = rect;
00565             <span class="keywordflow">break</span>;
00566     }
00567 
00568     d_title-&gt;<a class="code" href="class_qwt_text.html#a8">setAlignment</a>(align);
00569 
00570     painter-&gt;save();
00571     painter-&gt;translate(r.x(), r.y());
00572 <span class="preprocessor">#ifndef QT_NO_TRANSFORMATIONS</span>
00573 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (angle != 0.0)
00574         painter-&gt;rotate(angle);
00575 <span class="preprocessor">#endif</span>
00576 <span class="preprocessor"></span>    d_title-&gt;<a class="code" href="class_qwt_text.html#a18">draw</a>(painter, QRect(0, 0, r.width(), r.height()));
00577 
00578     <span class="comment">// Users do not expect to see AlignTop or AlignBottom</span>
00579     d_title-&gt;<a class="code" href="class_qwt_text.html#a8">setAlignment</a>(align &amp; ~(Qt::AlignTop | Qt::AlignBottom));
00580     painter-&gt;restore();
00581 }
00582 
<a name="l00591"></a><a class="code" href="class_qwt_scale.html#b3">00591</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#b3">QwtScale::scaleChange</a>()
00592 {
00593     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00594 }
00595 
<a name="l00600"></a><a class="code" href="class_qwt_scale.html#a28">00600</a> QSizePolicy <a class="code" href="class_qwt_scale.html#a28">QwtScale::sizePolicy</a>()<span class="keyword"> const</span>
00601 <span class="keyword"></span>{
00602     QSizePolicy sp;
00603     <span class="keywordflow">if</span> ( d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>() == QwtScaleDraw::Left ||
00604         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>() == QwtScaleDraw::Right )
00605     {
00606         sp.setHorData( QSizePolicy::Fixed );
00607         sp.setVerData( QSizePolicy::MinimumExpanding );
00608     }
00609     <span class="keywordflow">else</span>
00610     {
00611         sp.setHorData( QSizePolicy::MinimumExpanding );
00612         sp.setVerData( QSizePolicy::Fixed );
00613     }
00614     <span class="keywordflow">return</span> sp;
00615 }
00616 
<a name="l00620"></a><a class="code" href="class_qwt_scale.html#a26">00620</a> QSize <a class="code" href="class_qwt_scale.html#a26">QwtScale::sizeHint</a>()<span class="keyword"> const</span>
00621 <span class="keyword"></span>{
00622     <span class="keywordflow">return</span> <a class="code" href="class_qwt_scale.html#a27">minimumSizeHint</a>();
00623 }
00624 
<a name="l00628"></a><a class="code" href="class_qwt_scale.html#a27">00628</a> QSize <a class="code" href="class_qwt_scale.html#a27">QwtScale::minimumSizeHint</a>()<span class="keyword"> const</span>
00629 <span class="keyword"></span>{
00630     Qt::Orientation o = Qt::Horizontal;
00631     <span class="keywordflow">if</span> ( d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>() == QwtScaleDraw::Left ||
00632         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>() == QwtScaleDraw::Right )
00633     {
00634         o = Qt::Vertical;
00635     }
00636 
00637     <span class="comment">// Border Distance cannot be less than the scale minBorderDist</span>
00638     <span class="comment">// Note, the minBorderDist is already included in minHeight/minWidth</span>
00639     <span class="keywordtype">int</span> length = 0;
00640     <span class="keywordtype">int</span> mbd1, mbd2;
00641     <a class="code" href="class_qwt_scale.html#a14">minBorderDist</a>(mbd1, mbd2);
00642     length += qwtMax( 0, d_borderDist[0] - mbd1 );
00643     length += qwtMax( 0, d_borderDist[1] - mbd2 );
00644 
00645     <span class="keyword">const</span> QFontMetrics fm(font());
00646     <span class="keywordflow">if</span> ( o == Qt::Vertical )
00647         length += d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a22">minHeight</a>(QPen(), fm);
00648     <span class="keywordflow">else</span>
00649         length += d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a23">minWidth</a>(QPen(), fm);
00650 
00651     <span class="keywordtype">int</span> dim = <a class="code" href="class_qwt_scale.html#a30">dimForLength</a>(length, fm);
00652     <span class="keywordflow">if</span> ( length &lt; dim )
00653     {
00654         <span class="comment">// compensate for long titles</span>
00655         length = dim;
00656         dim = <a class="code" href="class_qwt_scale.html#a30">dimForLength</a>(length, fm);
00657     }
00658 
00659     QSize size(length + 2, dim);
00660     <span class="keywordflow">if</span> ( o == Qt::Vertical )
00661         size.transpose();
00662 
00663     <span class="keywordflow">return</span> size;
00664 }
00665 
<a name="l00672"></a><a class="code" href="class_qwt_scale.html#a29">00672</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a29">QwtScale::titleHeightForWidth</a>(<span class="keywordtype">int</span> width)<span class="keyword"> const</span>
00673 <span class="keyword"></span>{
00674     <span class="keywordflow">return</span> d_title-&gt;<a class="code" href="class_qwt_text.html#a16">heightForWidth</a>(width);
00675 }
00676 
<a name="l00686"></a><a class="code" href="class_qwt_scale.html#a30">00686</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale.html#a30">QwtScale::dimForLength</a>(<span class="keywordtype">int</span> length,
00687     <span class="keyword">const</span> QFontMetrics &amp;scaleFontMetrics)<span class="keyword"> const</span>
00688 <span class="keyword"></span>{
00689     <span class="keywordtype">int</span> dim = d_baseDist;
00690     <span class="keywordflow">if</span> ( d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>() == QwtScaleDraw::Left ||
00691         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a10">orientation</a>() == QwtScaleDraw::Right )
00692     {
00693         dim += d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a23">minWidth</a>(QPen(), scaleFontMetrics);
00694 <span class="preprocessor">#ifdef QT_NO_TRANSFORMATIONS</span>
00695 <span class="preprocessor"></span>        <span class="keywordflow">return</span> dim;
00696 <span class="preprocessor">#endif</span>
00697 <span class="preprocessor"></span>    }
00698     <span class="keywordflow">else</span>
00699         dim += d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a22">minHeight</a>(QPen(), scaleFontMetrics);
00700 
00701     <span class="keywordflow">if</span> ( !d_title-&gt;<a class="code" href="class_qwt_text.html#a2">text</a>().<a class="code" href="class_qwt_text.html#a4">isEmpty</a>() )
00702     {
00703         dim += <a class="code" href="class_qwt_scale.html#a29">titleHeightForWidth</a>(length) + d_titleDist;
00704     }
00705     <span class="keywordflow">return</span> dim;
00706 }
00707 
<a name="l00718"></a><a class="code" href="class_qwt_scale.html#a14">00718</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a14">QwtScale::minBorderDist</a>(<span class="keywordtype">int</span> &amp;start, <span class="keywordtype">int</span> &amp;end)<span class="keyword"> const</span>
00719 <span class="keyword"></span>{
00720     <span class="keyword">const</span> QFontMetrics fm(font());
00721     d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a20">minBorderDist</a>(fm, start, end);
00722 }
00723 
<a name="l00732"></a><a class="code" href="class_qwt_scale.html#b4">00732</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#b4">QwtScale::fontChange</a>(<span class="keyword">const</span> QFont &amp;oldFont)
00733 {
00734     QWidget::fontChange( oldFont );
00735     <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00736 }
00737 
<a name="l00746"></a><a class="code" href="class_qwt_scale.html#a19">00746</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale.html#a19">QwtScale::setScaleDiv</a>(<span class="keyword">const</span> <a class="code" href="class_qwt_scale_div.html">QwtScaleDiv</a> &amp;sd)
00747 {
00748     <span class="keywordflow">if</span> (d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a17">scaleDiv</a>() != sd)
00749     {
00750         d_scaleDraw-&gt;<a class="code" href="class_qwt_scale_draw.html#a2">setScale</a>(sd);
00751         <a class="code" href="class_qwt_scale.html#b5">layoutScale</a>();
00752     }
00753 }
00754 
00755 <span class="comment">// Local Variables:</span>
00756 <span class="comment">// mode: C++</span>
00757 <span class="comment">// c-file-style: "stroustrup"</span>
00758 <span class="comment">// indent-tabs-mode: nil</span>
00759 <span class="comment">// End:</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Nov 20 13:42:37 2004 for Qwt User's Guide by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
