<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Qwt User&apos;s Guide: qwt_scldraw.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>qwt_scldraw.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* -*- mode: C++ ; c-file-style: "stroustrup" -*- *****************************</span>
00002 <span class="comment"> * Qwt Widget Library</span>
00003 <span class="comment"> * Copyright (C) 1997   Josef Wilgen</span>
00004 <span class="comment"> * Copyright (C) 2002   Uwe Rathmann</span>
00005 <span class="comment"> * </span>
00006 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
00007 <span class="comment"> * modify it under the terms of the Qwt License, Version 1.0</span>
00008 <span class="comment"> *****************************************************************************/</span>
00009 
00010 <span class="comment">// vim: expandtab</span>
00011 
00012 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00013 <span class="preprocessor">#include &lt;qpainter.h&gt;</span>
00014 <span class="preprocessor">#include "<a class="code" href="qwt__math_8h.html">qwt_math.h</a>"</span>
00015 <span class="preprocessor">#include "qwt_painter.h"</span>
00016 <span class="preprocessor">#include "qwt_scldraw.h"</span>
00017 <span class="preprocessor">#include "qwt_layout_metrics.h"</span>
00018 
00019 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> step_eps = 1.0e-6;
00020 
<a name="l00029"></a><a class="code" href="class_qwt_scale_draw.html#a0">00029</a> <a class="code" href="class_qwt_scale_draw.html#a0">QwtScaleDraw::QwtScaleDraw</a>():
00030     d_options(Backbone),
00031     d_hpad(4),
00032     d_vpad(4),
00033     d_medLen(6),
00034     d_majLen(8),
00035     d_minLen(4),
00036     d_minAngle(-135 * 16),
00037     d_maxAngle(135 * 16),
00038     d_fmt('g'),
00039     d_prec(4),
00040     d_fieldwidth(0),
00041     d_labelAlignment(0),
00042     d_labelRotation(0.0)
00043 {
00044     <span class="comment">// snprintf is C99 and therefore not portable :-(</span>
00045     <span class="comment">// fieldwidth and precision must be in the range 0, 1, .., 99.</span>
00046     sprintf(d_formatBuffer, <span class="stringliteral">"%%%d.%d%c"</span>, d_fieldwidth, d_prec, d_fmt);
00047     <a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(0,0,100,Bottom);
00048     <a class="code" href="class_qwt_scale_draw.html#a2">setScale</a>(0,100,0,0,10);
00049 }
00050 
<a name="l00052"></a><a class="code" href="class_qwt_scale_draw.html#a1">00052</a> <a class="code" href="class_qwt_scale_draw.html#a1">QwtScaleDraw::~QwtScaleDraw</a>()
00053 {
00054 }
00055 
<a name="l00057"></a><a class="code" href="class_qwt_scale_draw.html#a4">00057</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a4">QwtScaleDraw::setOptions</a>(<span class="keywordtype">int</span> opt)
00058 {
00059     d_options = opt;
00060 }
00061 
<a name="l00065"></a><a class="code" href="class_qwt_scale_draw.html#a5">00065</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a5">QwtScaleDraw::options</a>()<span class="keyword"> const</span>
00066 <span class="keyword"></span>{
00067     <span class="keywordflow">return</span> d_options;
00068 }
00069 
<a name="l00082"></a><a class="code" href="class_qwt_scale_draw.html#a3">00082</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a2">QwtScaleDraw::setScale</a>(<span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> x2, <span class="keywordtype">int</span> maxMajIntv,
00083                             <span class="keywordtype">int</span> maxMinIntv, <span class="keywordtype">double</span> step, <span class="keywordtype">int</span> logscale)
00084 {
00085     d_scldiv.<a class="code" href="class_qwt_scale_div.html#a12">rebuild</a>( x1, x2, maxMajIntv, maxMinIntv, logscale, step, FALSE );
00086     <a class="code" href="class_qwt_di_map.html#a6">setDblRange</a>( d_scldiv.<a class="code" href="class_qwt_scale_div.html#a3">lBound</a>(), d_scldiv.<a class="code" href="class_qwt_scale_div.html#a4">hBound</a>(), d_scldiv.<a class="code" href="class_qwt_scale_div.html#a7">logScale</a>());
00087 }
00088 
00089 
<a name="l00094"></a><a class="code" href="class_qwt_scale_draw.html#a2">00094</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a2">QwtScaleDraw::setScale</a>(<span class="keyword">const</span> <a class="code" href="class_qwt_scale_div.html">QwtScaleDiv</a> &amp;sd)
00095 {
00096     d_scldiv = sd;
00097     <a class="code" href="class_qwt_di_map.html#a6">setDblRange</a>(d_scldiv.<a class="code" href="class_qwt_scale_div.html#a3">lBound</a>(),d_scldiv.<a class="code" href="class_qwt_scale_div.html#a4">hBound</a>(),d_scldiv.<a class="code" href="class_qwt_scale_div.html#a7">logScale</a>());
00098 }
00099 
<a name="l00104"></a><a class="code" href="class_qwt_scale_draw.html#a29">00104</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a29">QwtScaleDraw::draw</a>(QPainter *p)<span class="keyword"> const</span>
00105 <span class="keyword"></span>{
00106     uint i;
00107 
00108     <span class="keywordflow">for</span> (i=0; i&lt; d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>(); i++)
00109     {
00110         <span class="keyword">const</span> <span class="keywordtype">double</span> val = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(i);
00111         <a class="code" href="class_qwt_scale_draw.html#b4">drawTick</a>(p, val, d_majLen);
00112         <a class="code" href="class_qwt_scale_draw.html#b6">drawLabel</a>(p, val);
00113     }
00114 
00115     <span class="keywordflow">if</span> (d_scldiv.<a class="code" href="class_qwt_scale_div.html#a7">logScale</a>())
00116     {
00117         <span class="keywordflow">for</span> (i=0; i&lt; d_scldiv.<a class="code" href="class_qwt_scale_div.html#a5">minCnt</a>(); i++)
00118             <a class="code" href="class_qwt_scale_draw.html#b4">drawTick</a>(p, d_scldiv.<a class="code" href="class_qwt_scale_div.html#a9">minMark</a>(i), d_minLen);
00119     }
00120     <span class="keywordflow">else</span>
00121     {
00122         <span class="keyword">const</span> <span class="keywordtype">int</span> kmax = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() - 1;
00123         <span class="keywordflow">if</span> (kmax &gt; 0) 
00124         {
00125             <span class="keywordtype">double</span> majTick = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(0);
00126             <span class="keywordtype">double</span> hval = majTick - 0.5 * d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>();
00127 
00128             <span class="keywordtype">int</span> k = 0;
00129             <span class="keywordflow">for</span> (i=0; i&lt; d_scldiv.<a class="code" href="class_qwt_scale_div.html#a5">minCnt</a>(); i++)
00130             {
00131                 <span class="keyword">const</span> <span class="keywordtype">double</span> val = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a9">minMark</a>(i);
00132                 <span class="keywordflow">if</span>  (val &gt; majTick)
00133                 {
00134                     <span class="keywordflow">if</span> (k &lt; kmax)
00135                     {
00136                         k++;
00137                         majTick = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(k);
00138                     }
00139                     <span class="keywordflow">else</span>
00140                     {
00141                         majTick += d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(kmax) + d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>();
00142                     }
00143                     hval = majTick - 0.5 * d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>();
00144 
00145                 }
00146                 <span class="keywordflow">if</span> (qwtAbs(val-hval) &lt; step_eps * d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>())
00147                     <a class="code" href="class_qwt_scale_draw.html#b4">drawTick</a>(p, val, d_medLen);
00148                 <span class="keywordflow">else</span>
00149                     <a class="code" href="class_qwt_scale_draw.html#b4">drawTick</a>(p, val, d_minLen);
00150             }
00151         }
00152     }
00153 
00154     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_scale_draw.html#a5">options</a>() &amp; Backbone )
00155         <a class="code" href="class_qwt_scale_draw.html#b5">drawBackbone</a>(p);
00156 }
00157 
00158 
<a name="l00160"></a><a class="code" href="class_qwt_scale_draw.html#b4">00160</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#b4">QwtScaleDraw::drawTick</a>(QPainter *p, <span class="keywordtype">double</span> val, <span class="keywordtype">int</span> len)<span class="keyword"> const</span>
00161 <span class="keyword"></span>{
00162     <span class="keywordflow">if</span> ( len &lt;= 0 )
00163         <span class="keywordflow">return</span>;
00164 
00165     <span class="keyword">const</span> <span class="keywordtype">int</span> tval = <a class="code" href="class_qwt_di_map.html#a7">transform</a>(val);
00166 
00167     <span class="keywordflow">switch</span>(d_orient)
00168     {
00169         <span class="keywordflow">case</span> Left:
00170             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, d_xorg, tval, d_xorg - len, tval);
00171             <span class="keywordflow">break</span>;
00172 
00173         <span class="keywordflow">case</span> Right:
00174             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, d_xorg, tval, d_xorg + len, tval);
00175             <span class="keywordflow">break</span>;
00176 
00177         <span class="keywordflow">case</span> Bottom: 
00178             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, tval, d_yorg, tval, d_yorg + len);
00179             <span class="keywordflow">break</span>;
00180 
00181         <span class="keywordflow">case</span> Top:
00182             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, tval, d_yorg, tval, d_yorg - len);
00183             <span class="keywordflow">break</span>;
00184 
00185         <span class="keywordflow">case</span> Round:
00186             <span class="keywordflow">if</span> ((tval &lt;= d_minAngle + 359 * 16) 
00187                 || (tval &gt;= d_minAngle - 359 * 16))
00188             {
00189                 <span class="keyword">const</span> <span class="keywordtype">double</span> arc = double(tval) / 16.0 * M_PI / 180.0;
00190                 <span class="keyword">const</span> <span class="keywordtype">int</span> x1 = qwtInt(d_xCenter + sin(arc) * d_radius);
00191                 <span class="keyword">const</span> <span class="keywordtype">int</span> x2 = qwtInt(d_xCenter + sin(arc) 
00192                     * (d_radius + <span class="keywordtype">double</span>(len)));
00193                 <span class="keyword">const</span> <span class="keywordtype">int</span> y1 = qwtInt(d_yCenter - cos(arc) * d_radius);
00194                 <span class="keyword">const</span> <span class="keywordtype">int</span> y2 = qwtInt(d_yCenter - cos(arc) 
00195                     * (d_radius + <span class="keywordtype">double</span>(len)));
00196 
00197                 <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, x1, y1, x2, y2);
00198             }
00199             <span class="keywordflow">break</span>;
00200     }
00201 }
00202 
<a name="l00204"></a><a class="code" href="class_qwt_scale_draw.html#b6">00204</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#b6">QwtScaleDraw::drawLabel</a>(QPainter *p, <span class="keywordtype">double</span> val)<span class="keyword"> const</span>
00205 <span class="keyword"></span>{
00206     QPoint pos;
00207     <span class="keywordtype">int</span> alignment;
00208     <span class="keywordtype">double</span> rotation;
00209     <a class="code" href="class_qwt_scale_draw.html#b0">labelPlacement</a>(QFontMetrics(p-&gt;font()), val, pos, alignment, rotation);
00210 
00211     <span class="keywordflow">if</span> ( alignment )
00212     {
00213         <span class="keyword">const</span> QString txt = <a class="code" href="class_qwt_scale_draw.html#a30">label</a>(val);
00214         <span class="keywordflow">if</span> ( !txt.isEmpty() )
00215         {
00216             QWMatrix m = <a class="code" href="class_qwt_scale_draw.html#b7">labelWorldMatrix</a>(QFontMetrics(p-&gt;font()),
00217                 pos, alignment, rotation, txt);
00218 
00219             p-&gt;save();
00220 <span class="preprocessor">#ifndef QT_NO_TRANSFORMATIONS</span>
00221 <span class="preprocessor"></span>            p-&gt;setWorldMatrix(m, TRUE);
00222 <span class="preprocessor">#else</span>
00223 <span class="preprocessor"></span>            p-&gt;translate(m.dx(), m.dy());
00224 <span class="preprocessor">#endif</span>
00225 <span class="preprocessor"></span>            <a class="code" href="class_qwt_painter.html#e7">QwtPainter::drawText</a>(p, 0, 0, txt);
00226             p-&gt;restore();
00227         }
00228     }
00229 }
00230 
<a name="l00232"></a><a class="code" href="class_qwt_scale_draw.html#b0">00232</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#b0">QwtScaleDraw::labelPlacement</a>( <span class="keyword">const</span> QFontMetrics &amp;fm, <span class="keywordtype">double</span> val, 
00233     QPoint &amp;pos, <span class="keywordtype">int</span> &amp;alignment, <span class="keywordtype">double</span> &amp;rotation)<span class="keyword"> const</span>
00234 <span class="keyword"></span>{
00235     <span class="comment">// correct rounding errors if val = 0</span>
00236     <span class="keywordflow">if</span> ((!d_scldiv.<a class="code" href="class_qwt_scale_div.html#a7">logScale</a>()) 
00237         &amp;&amp; (qwtAbs(val) &lt; qwtAbs(step_eps * d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>())))
00238     {
00239        val = 0.0;
00240     }
00241     
00242     <span class="keyword">const</span> <span class="keywordtype">int</span> tval = <a class="code" href="class_qwt_di_map.html#a7">transform</a>(val);
00243 
00244     <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a7">x</a> = 0;
00245     <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a8">y</a> = 0;
00246     <span class="keywordtype">int</span> align = 0;
00247 
00248     <span class="keywordflow">switch</span>(d_orient)
00249     {
00250         <span class="keywordflow">case</span> Right:
00251         {
00252             x = d_xorg + d_majLen + d_hpad + 1;
00253             y = tval;
00254             align = d_labelAlignment;
00255             <span class="keywordflow">if</span> ( align == 0 )
00256                 align = Qt::AlignRight | Qt::AlignVCenter;
00257             <span class="keywordflow">break</span>;
00258         }
00259         <span class="keywordflow">case</span> Left:
00260         {
00261             x = d_xorg - d_majLen - d_hpad - 1;
00262             y = tval;
00263             align = d_labelAlignment;
00264             <span class="keywordflow">if</span> ( align == 0 )
00265                 align = Qt::AlignLeft | Qt::AlignVCenter;
00266             <span class="keywordflow">break</span>;
00267         }
00268         <span class="keywordflow">case</span> Bottom:
00269         {
00270             x = tval;
00271             y = d_yorg + d_majLen + d_vpad + 1;
00272             align = d_labelAlignment;
00273             <span class="keywordflow">if</span> ( align == 0 )
00274                 align = Qt::AlignHCenter | Qt::AlignBottom;
00275             <span class="keywordflow">break</span>;
00276         }
00277         <span class="keywordflow">case</span> Top:
00278         {
00279             x = tval;
00280             y = d_yorg - d_majLen - d_vpad - 1;
00281             align = d_labelAlignment;
00282             <span class="keywordflow">if</span> ( align == 0 )
00283                 align = Qt::AlignHCenter | Qt::AlignTop;
00284             <span class="keywordflow">break</span>;
00285         }
00286         <span class="keywordflow">case</span> Round:
00287         {
00288             <span class="keywordflow">if</span> ((tval &gt; d_minAngle + 359 * 16) 
00289                 || (tval &lt; d_minAngle - 359 * 16))
00290             {
00291                <span class="keywordflow">break</span>;
00292             }
00293             
00294             <span class="keyword">const</span> <span class="keywordtype">int</span> fmh = fm.ascent() - 2; 
00295             <span class="keyword">const</span> <span class="keywordtype">double</span> arc = tval / 16.0 / 360.0 * 2 * M_PI;
00296             <span class="keyword">const</span> <span class="keywordtype">double</span> radius = d_radius + d_majLen + d_vpad;
00297 
00298             <span class="comment">// First we find the point on a circle enlarged</span>
00299             <span class="comment">// by half of the font height.</span>
00300 
00301             <span class="keywordtype">double</span> xOffset = ( radius + fmh / 2 ) * sin(arc); 
00302             <span class="keywordtype">double</span> yOffset = ( radius + fmh / 2 ) * cos(arc);
00303 
00304             <span class="keywordflow">if</span> ( qwtInt(xOffset) != 0 ) 
00305             {
00306                 <span class="comment">// The centered label might cut the circle </span>
00307                 <span class="comment">// with distance: d_radius + d_majLen + d_vpad</span>
00308                 <span class="comment">// We align the label to the circle by moving</span>
00309                 <span class="comment">// the x-coordinate, because we have only</span>
00310                 <span class="comment">// horizontal labels here.</span>
00311 
00312                 <span class="keyword">const</span> <span class="keywordtype">int</span> fmw = fm.width(<a class="code" href="class_qwt_scale_draw.html#a30">label</a>(val));
00313 
00314                 <span class="keyword">const</span> <span class="keywordtype">double</span> circleX = radius * sin(arc); 
00315                 <span class="keywordflow">if</span> ( xOffset &lt; 0 )
00316                     xOffset = circleX - fmw / 2; <span class="comment">// left</span>
00317                 <span class="keywordflow">else</span>
00318                     xOffset = circleX + fmw / 2; <span class="comment">// right</span>
00319             }
00320             x = qwtInt(d_xCenter + xOffset);
00321             y = qwtInt(d_yCenter - yOffset);
00322             align = Qt::AlignHCenter | Qt::AlignVCenter;
00323 
00324             <span class="keywordflow">break</span>;
00325         }
00326     }
00327 
00328     pos = QPoint(x, y);
00329     alignment = align;
00330     rotation = d_labelRotation;
00331 }
00332 
00334 
<a name="l00335"></a><a class="code" href="class_qwt_scale_draw.html#b7">00335</a> QWMatrix <a class="code" href="class_qwt_scale_draw.html#b7">QwtScaleDraw::labelWorldMatrix</a>(<span class="keyword">const</span> QFontMetrics &amp;fm,
00336     <span class="keyword">const</span> QPoint &amp;pos, <span class="keywordtype">int</span> alignment, 
00337 #ifdef QT_NO_TRANSFORMATIONS
00338     <span class="keywordtype">double</span>,
00339 #<span class="keywordflow">else</span>
00340     <span class="keywordtype">double</span> rotation, 
00341 #endif
00342     <span class="keyword">const</span> QString &amp;txt)<span class="keyword"> const</span>
00343 <span class="keyword"></span>{
00344     <span class="keyword">const</span> <span class="keywordtype">int</span> w = fm.boundingRect(0, 0, 
00345         QCOORD_MAX, QCOORD_MAX, 0, txt).width() - 2;
00346     <span class="keyword">const</span> <span class="keywordtype">int</span> h = fm.ascent() - 2;
00347     
00348     <span class="keywordtype">int</span> x, y;
00349     <span class="keywordflow">if</span> ( alignment &amp; Qt::AlignLeft )
00350         x = -w;
00351     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( alignment &amp; Qt::AlignRight )
00352         x = 0 - w % 2;
00353     <span class="keywordflow">else</span> <span class="comment">// Qt::AlignHCenter</span>
00354         x = -(w / 2);
00355         
00356     <span class="keywordflow">if</span> ( alignment &amp; Qt::AlignTop )
00357         y = 0;
00358     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( alignment &amp; Qt::AlignBottom )
00359         y = h - 1;
00360     <span class="keywordflow">else</span> <span class="comment">// Qt::AlignVCenter</span>
00361         y = h / 2;
00362     
00363     QWMatrix m;
00364     m.translate(pos.x(), pos.y());
00365 <span class="preprocessor">#ifndef QT_NO_TRANSFORMATIONS</span>
00366 <span class="preprocessor"></span>    m.rotate(rotation);
00367 <span class="preprocessor">#endif</span>
00368 <span class="preprocessor"></span>    m.translate(x, y);
00369 
00370     <span class="keywordflow">return</span> m;
00371 }
00372 
<a name="l00374"></a><a class="code" href="class_qwt_scale_draw.html#b5">00374</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#b5">QwtScaleDraw::drawBackbone</a>(QPainter *p)<span class="keyword"> const</span>
00375 <span class="keyword"></span>{
00376     <span class="keyword">const</span> <span class="keywordtype">int</span> bw2 = p-&gt;pen().width() / 2;
00377     
00378     <span class="keywordflow">switch</span>(d_orient)
00379     {
00380         <span class="keywordflow">case</span> Left:
00381             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, d_xorg - bw2, 
00382                 d_yorg, d_xorg - bw2, d_yorg + d_len - 1);
00383             <span class="keywordflow">break</span>;
00384         <span class="keywordflow">case</span> Right:
00385             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, d_xorg + bw2, 
00386                 d_yorg, d_xorg + bw2, d_yorg + d_len - 1);
00387             <span class="keywordflow">break</span>;
00388         <span class="keywordflow">case</span> Top:
00389             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, d_xorg, d_yorg - bw2, 
00390                 d_xorg + d_len - 1, d_yorg - bw2);
00391             <span class="keywordflow">break</span>;
00392         <span class="keywordflow">case</span> Bottom:
00393             <a class="code" href="class_qwt_painter.html#e16">QwtPainter::drawLine</a>(p, d_xorg, d_yorg + bw2, 
00394                 d_xorg + d_len - 1, d_yorg + bw2);
00395             <span class="keywordflow">break</span>;
00396         <span class="keywordflow">case</span> Round:
00397         {
00398             <span class="keyword">const</span> <span class="keywordtype">int</span> a1 = qwtMin(<a class="code" href="class_qwt_di_map.html#a13">i1</a>(), <a class="code" href="class_qwt_di_map.html#a14">i2</a>()) - 90 * 16; 
00399             <span class="keyword">const</span> <span class="keywordtype">int</span> a2 = qwtMax(<a class="code" href="class_qwt_di_map.html#a13">i1</a>(), <a class="code" href="class_qwt_di_map.html#a14">i2</a>()) - 90 * 16; 
00400             
00401             p-&gt;drawArc(d_xorg, d_yorg, d_len, d_len,
00402                 -a2, a2 - a1 + 1);           <span class="comment">// counterclockwise</span>
00403             <span class="keywordflow">break</span>;
00404         }
00405     }
00406 }
00407 
00408 
<a name="l00448"></a><a class="code" href="class_qwt_scale_draw.html#a6">00448</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a6">QwtScaleDraw::setGeometry</a>(<span class="keywordtype">int</span> xorigin, <span class="keywordtype">int</span> yorigin, 
00449     <span class="keywordtype">int</span> length, Orientation o)
00450 {
00451     <span class="keyword">static</span> <span class="keywordtype">int</span> minLen = 10;
00452 
00453     d_xorg = xorigin;
00454     d_yorg = yorigin;
00455     d_radius = double(length) * 0.5;
00456     d_xCenter = double(xorigin) + double(length) * 0.5;
00457     d_yCenter = double(yorigin) + double(length) * 0.5;
00458     
00459     <span class="keywordflow">if</span> (length &gt; minLen)
00460        d_len = length;
00461     <span class="keywordflow">else</span>
00462        d_len = minLen;
00463     
00464     d_orient = o;
00465     
00466     <span class="keywordflow">switch</span>(d_orient)
00467     {
00468         <span class="keywordflow">case</span> Left:
00469         <span class="keywordflow">case</span> Right:
00470             <a class="code" href="class_qwt_di_map.html#a5">setIntRange</a>(d_yorg + d_len - 1, d_yorg);
00471             <span class="keywordflow">break</span>;
00472         <span class="keywordflow">case</span> Round:
00473             <a class="code" href="class_qwt_di_map.html#a5">setIntRange</a>(d_minAngle, d_maxAngle);
00474             <span class="keywordflow">break</span>;
00475         <span class="keywordflow">case</span> Top:
00476         <span class="keywordflow">case</span> Bottom:
00477             <a class="code" href="class_qwt_di_map.html#a5">setIntRange</a>(d_xorg, d_xorg + d_len - 1);
00478             <span class="keywordflow">break</span>;
00479     }
00480 }
00481 
<a name="l00487"></a><a class="code" href="class_qwt_scale_draw.html#a18">00487</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a18">QwtScaleDraw::maxWidth</a>(<span class="keyword">const</span> QPen &amp;pen, <span class="keyword">const</span> QFontMetrics &amp;fm)<span class="keyword"> const</span>
00488 <span class="keyword"></span>{
00489     <span class="keywordtype">int</span> w = 0;
00490 
00491     <span class="keywordflow">switch</span> (d_orient)
00492     {
00493         <span class="keywordflow">case</span> Left:
00494         <span class="keywordflow">case</span> Right:
00495             w += pen.width() + d_majLen + d_hpad + <a class="code" href="class_qwt_scale_draw.html#b2">maxLabelWidth</a>(fm);
00496             <span class="keywordflow">break</span>;
00497         <span class="keywordflow">case</span> Round:
00498             w += pen.width() + d_majLen + d_vpad + <a class="code" href="class_qwt_scale_draw.html#b2">maxLabelWidth</a>(fm);
00499             <span class="keywordflow">break</span>;
00500         <span class="keywordflow">case</span> Top:
00501         <span class="keywordflow">case</span> Bottom:
00502             w = d_len + <a class="code" href="class_qwt_scale_draw.html#b2">maxLabelWidth</a>(fm);
00503             <span class="keywordflow">break</span>;
00504     }
00505     <span class="keywordflow">return</span> w;
00506 }
00507 
<a name="l00513"></a><a class="code" href="class_qwt_scale_draw.html#a19">00513</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a19">QwtScaleDraw::maxHeight</a>(<span class="keyword">const</span> QPen &amp;pen, <span class="keyword">const</span> QFontMetrics &amp;fm)<span class="keyword"> const </span>
00514 <span class="keyword"></span>{
00515     <span class="keywordtype">int</span> h = 0;
00516     
00517     <span class="keywordflow">switch</span> (d_orient)
00518     {
00519         <span class="keywordflow">case</span> Top:
00520         <span class="keywordflow">case</span> Bottom:
00521             h = pen.width() + d_vpad + d_majLen + <a class="code" href="class_qwt_scale_draw.html#b1">maxLabelHeight</a>(fm);
00522             <span class="keywordflow">break</span>;
00523         <span class="keywordflow">case</span> Left:
00524         <span class="keywordflow">case</span> Right:
00525             h = d_len + <a class="code" href="class_qwt_scale_draw.html#b1">maxLabelHeight</a>(fm);
00526             <span class="keywordflow">break</span>;
00527         <span class="keywordflow">case</span> Round:
00528             h = d_vpad + d_majLen;
00529             <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_scale_draw.html#b1">maxLabelHeight</a>(fm) &gt; 0 )
00530                 h += fm.ascent() - 2;
00531             <span class="keywordflow">break</span>;
00532     }
00533     
00534     <span class="keywordflow">return</span> h;
00535 }
00536 
<a name="l00546"></a><a class="code" href="class_qwt_scale_draw.html#a14">00546</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a14">QwtScaleDraw::setLabelRotation</a>(<span class="keywordtype">double</span> rotation)
00547 {
00548     d_labelRotation = rotation;
00549 }
00550 
<a name="l00555"></a><a class="code" href="class_qwt_scale_draw.html#a26">00555</a> <span class="keywordtype">double</span> <a class="code" href="class_qwt_scale_draw.html#a26">QwtScaleDraw::labelRotation</a>()<span class="keyword"> const</span>
00556 <span class="keyword"></span>{
00557     <span class="keywordflow">return</span> d_labelRotation;
00558 }
00559 
<a name="l00579"></a><a class="code" href="class_qwt_scale_draw.html#a13">00579</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a13">QwtScaleDraw::setLabelAlignment</a>(<span class="keywordtype">int</span> alignment)
00580 {
00581     d_labelAlignment = alignment;
00582 }
00583 
<a name="l00588"></a><a class="code" href="class_qwt_scale_draw.html#a25">00588</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a25">QwtScaleDraw::labelAlignment</a>()<span class="keyword"> const</span>
00589 <span class="keyword"></span>{
00590     <span class="keywordflow">return</span> d_labelAlignment;
00591 }
00592 
<a name="l00611"></a><a class="code" href="class_qwt_scale_draw.html#a11">00611</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a11">QwtScaleDraw::setAngleRange</a>(<span class="keywordtype">double</span> angle1, <span class="keywordtype">double</span> angle2)
00612 {
00613     angle1 = <a class="code" href="qwt__math_8h.html#a37">qwtLim</a>(angle1, -360.0, 360.0);
00614     angle2 = <a class="code" href="qwt__math_8h.html#a37">qwtLim</a>(angle2, -360.0, 360.0);
00615 
00616     <span class="keywordtype">int</span> amin = int(floor (qwtMin(angle1, angle2) * 16.0 + 0.5));
00617     <span class="keywordtype">int</span> amax = int(floor (qwtMax(angle1, angle2) * 16.0 + 0.5));
00618     
00619     <span class="keywordflow">if</span> (amin == amax)
00620     {
00621         amin -= 1;
00622         amax += 1;
00623     }
00624     
00625     d_minAngle = amin;
00626     d_maxAngle = amax;
00627     <a class="code" href="class_qwt_di_map.html#a5">setIntRange</a>(d_minAngle, d_maxAngle);
00628 }
00629 
<a name="l00646"></a><a class="code" href="class_qwt_scale_draw.html#a12">00646</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a12">QwtScaleDraw::setLabelFormat</a>(<span class="keywordtype">char</span> f, <span class="keywordtype">int</span> prec, <span class="keywordtype">int</span> fieldwidth)
00647 {
00648     <span class="keywordflow">switch</span>(f)
00649     {
00650         <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
00651         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00652         <span class="keywordflow">case</span> <span class="charliteral">'g'</span>:
00653             d_fmt = f;
00654             <span class="keywordflow">break</span>;
00655         <span class="keywordflow">default</span>:
00656             <span class="keywordflow">break</span>;
00657     }
00658     <span class="keywordflow">if</span> ((prec &gt; -1) &amp;&amp; (prec &lt; 99))
00659         d_prec = prec;
00660     <span class="keywordflow">if</span> ((fieldwidth &gt; -1) &amp;&amp; (fieldwidth &lt; 99))
00661         d_fieldwidth = fieldwidth;
00662 
00663     sprintf(d_formatBuffer, <span class="stringliteral">"%%%d.%d%c"</span>, d_fieldwidth, d_prec, d_fmt);
00664 }
00665 
<a name="l00679"></a><a class="code" href="class_qwt_scale_draw.html#a24">00679</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a24">QwtScaleDraw::labelFormat</a>(<span class="keywordtype">char</span> &amp;f, <span class="keywordtype">int</span> &amp;prec, <span class="keywordtype">int</span> &amp;fieldwidth)<span class="keyword"> const</span>
00680 <span class="keyword"></span>{
00681     f = d_fmt;
00682     prec = d_prec;
00683     fieldwidth = d_fieldwidth;
00684 }
00685 
<a name="l00692"></a><a class="code" href="class_qwt_scale_draw.html#a16">00692</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a16">QwtScaleDraw::setMargin</a>(uint hMargin, uint vMargin)
00693 {
00694     d_hpad = hMargin;
00695     d_vpad = vMargin;
00696 }
00697 
<a name="l00701"></a><a class="code" href="class_qwt_scale_draw.html#a15">00701</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a15">QwtScaleDraw::setTickLength</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> minLen, 
00702     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> medLen, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> majLen)
00703 {
00704     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxTickLen = 1000;
00705 
00706     d_minLen = QMIN(minLen, maxTickLen);
00707     d_medLen = QMIN(medLen, maxTickLen);
00708     d_majLen = QMIN(majLen, maxTickLen);
00709 }
00710 
<a name="l00715"></a><a class="code" href="class_qwt_scale_draw.html#a27">00715</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a27">QwtScaleDraw::tickLength</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;minLen,
00716         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;medLen, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;majLen)<span class="keyword"> const</span>
00717 <span class="keyword"></span>{
00718     minLen = d_minLen;
00719     medLen = d_medLen;
00720     majLen = d_majLen;
00721 }
00722 
<a name="l00727"></a><a class="code" href="class_qwt_scale_draw.html#a28">00727</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a28">QwtScaleDraw::majTickLength</a>()<span class="keyword"> const</span>
00728 <span class="keyword"></span>{
00729     <span class="keywordflow">return</span> d_majLen;
00730 }
00731 
<a name="l00736"></a><a class="code" href="class_qwt_scale_draw.html#b2">00736</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#b2">QwtScaleDraw::maxLabelWidth</a>(<span class="keyword">const</span> QFontMetrics &amp;fm)<span class="keyword"> const</span>
00737 <span class="keyword"></span>{
00738     <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a18">maxWidth</a> = 0;
00739 
00740     <span class="keywordflow">for</span> (uint i = 0; i &lt; d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>(); i++)
00741     {
00742         <span class="keywordtype">double</span> val = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(i);
00743 
00744         <span class="comment">// correct rounding errors if val = 0</span>
00745 
00746         <span class="keywordflow">if</span> ((!d_scldiv.<a class="code" href="class_qwt_scale_div.html#a7">logScale</a>()) 
00747             &amp;&amp; (qwtAbs(val) &lt; step_eps * qwtAbs(d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>())))
00748         {
00749             val = 0.0;
00750         }
00751 
00752         <span class="keyword">const</span> <span class="keywordtype">int</span> w = <a class="code" href="class_qwt_scale_draw.html#b3">labelBoundingRect</a>(fm, val).width();
00753         <span class="keywordflow">if</span> ( w &gt; maxWidth )
00754             maxWidth = w;
00755     }
00756 
00757     <span class="keywordflow">return</span> maxWidth;
00758 }
00759 
<a name="l00764"></a><a class="code" href="class_qwt_scale_draw.html#b1">00764</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#b1">QwtScaleDraw::maxLabelHeight</a>(<span class="keyword">const</span> QFontMetrics &amp;fm)<span class="keyword"> const</span>
00765 <span class="keyword"></span>{
00766     <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a19">maxHeight</a> = 0;
00767 
00768     <span class="keywordflow">for</span> (uint i = 0; i &lt; d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>(); i++)
00769     {
00770         <span class="keywordtype">double</span> val = d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(i);
00771 
00772         <span class="comment">// correct rounding errors if val = 0</span>
00773 
00774         <span class="keywordflow">if</span> ((!d_scldiv.<a class="code" href="class_qwt_scale_div.html#a7">logScale</a>()) 
00775             &amp;&amp; (qwtAbs(val) &lt; step_eps * qwtAbs(d_scldiv.<a class="code" href="class_qwt_scale_div.html#a10">majStep</a>())))
00776         {
00777             val = 0.0;
00778         }
00779 
00780         <span class="keyword">const</span> <span class="keywordtype">int</span> h = <a class="code" href="class_qwt_scale_draw.html#b3">labelBoundingRect</a>(fm, val).height();
00781         <span class="keywordflow">if</span> ( h &gt; maxHeight )
00782             maxHeight = h;
00783     }
00784 
00785     <span class="keywordflow">return</span> maxHeight;
00786 }
00787 
<a name="l00793"></a><a class="code" href="class_qwt_scale_draw.html#b3">00793</a> QRect <a class="code" href="class_qwt_scale_draw.html#b3">QwtScaleDraw::labelBoundingRect</a>(
00794     <span class="keyword">const</span> QFontMetrics &amp;fm, <span class="keywordtype">double</span> val)<span class="keyword"> const</span>
00795 <span class="keyword"></span>{
00796     QString zeroString;
00797     <span class="keywordflow">if</span> ( d_fieldwidth &gt; 0 )
00798         zeroString.fill(<span class="charliteral">'0'</span>, d_fieldwidth);
00799 
00800     <span class="keyword">const</span> QString lbl = <a class="code" href="class_qwt_scale_draw.html#a30">label</a>(val);
00801 
00802     <span class="keyword">const</span> QString &amp;txt = fm.width(zeroString) &gt; fm.width(lbl) 
00803         ? zeroString : lbl;
00804     <span class="keywordflow">if</span> ( txt.isEmpty() )
00805         <span class="keywordflow">return</span> QRect(0, 0, 0, 0);
00806 
00807     QRect br;
00808 
00809     QPoint pos;
00810     <span class="keywordtype">int</span> alignment;
00811     <span class="keywordtype">double</span> rotation;
00812 
00813     <a class="code" href="class_qwt_scale_draw.html#b0">labelPlacement</a>(fm, val, pos, alignment, rotation);
00814     <span class="keywordflow">if</span> ( alignment )
00815     {
00816         <span class="comment">// Don't use fm.boundingRect(txt), it cuts off pixels.</span>
00817         <span class="keyword">const</span> <span class="keywordtype">int</span> w = fm.boundingRect(0, 0, 
00818             QCOORD_MAX, QCOORD_MAX, 0, txt).width();
00819         <span class="keyword">const</span> <span class="keywordtype">int</span> h = -(fm.ascent() - 2);
00820 
00821         QWMatrix m = <a class="code" href="class_qwt_scale_draw.html#b7">labelWorldMatrix</a>(fm, pos, alignment, rotation, txt);
00822         br = QwtMetricsMap::translate(m, QRect(0, 0, w, h));
00823         br.moveBy(-pos.x(), -pos.y());
00824     }
00825 
00826     <span class="keywordflow">return</span> br;
00827 }
00828 
<a name="l00839"></a><a class="code" href="class_qwt_scale_draw.html#a20">00839</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_scale_draw.html#a20">QwtScaleDraw::minBorderDist</a>(<span class="keyword">const</span> QFontMetrics &amp;fm,
00840     <span class="keywordtype">int</span> &amp;start, <span class="keywordtype">int</span> &amp;end )<span class="keyword"> const</span>
00841 <span class="keyword"></span>{
00842     start = 0;
00843     end = 0;
00844 
00845     <span class="keywordflow">if</span> ( d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() &gt; 0 )
00846     {
00847         <span class="keyword">const</span> QRect labelRectMin = <a class="code" href="class_qwt_scale_draw.html#b3">labelBoundingRect</a>(fm, d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(0));
00848         <span class="keyword">const</span> QRect labelRectMax = <a class="code" href="class_qwt_scale_draw.html#b3">labelBoundingRect</a>(fm, 
00849             d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() - 1));
00850 
00851         <span class="keywordflow">switch</span> (d_orient)
00852         {
00853             <span class="keywordflow">case</span> Left:
00854             <span class="keywordflow">case</span> Right:
00855                 end = -labelRectMin.y();
00856                 start = labelRectMax.height() + labelRectMax.y();
00857                 <span class="keywordflow">break</span>;
00858             <span class="keywordflow">case</span> Top:
00859             <span class="keywordflow">case</span> Bottom:
00860                 start = -labelRectMin.x();
00861                 end = labelRectMax.width() + labelRectMax.x();
00862                 <span class="keywordflow">break</span>;
00863             <span class="keywordflow">case</span> Round:
00864                 start = labelRectMin.width();
00865                 end = labelRectMax.width();
00866                 <span class="keywordflow">break</span>;
00867         }
00868     }
00869 }
00870 
<a name="l00880"></a><a class="code" href="class_qwt_scale_draw.html#a21">00880</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a21">QwtScaleDraw::minLabelDist</a>(<span class="keyword">const</span> QFontMetrics &amp;fm)<span class="keyword"> const</span>
00881 <span class="keyword"></span>{
00882     <span class="keywordflow">if</span> ( d_orient == Round ) <span class="comment">// no implementation</span>
00883         <span class="keywordflow">return</span> 0;
00884 
00885     <span class="keywordflow">if</span> (0 == d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>())
00886     {
00887         <span class="keywordflow">return</span> 0;
00888     }
00889 
00890     <span class="keyword">const</span> <span class="keywordtype">bool</span> vertical = (d_orient == Left || d_orient == Right);
00891 
00892     QRect bRect1;
00893     QRect bRect2 = <a class="code" href="class_qwt_scale_draw.html#b3">labelBoundingRect</a>(fm, d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(0));
00894     <span class="keywordflow">if</span> ( vertical )
00895     {
00896         bRect2.setRect(-bRect2.bottom(), 0, bRect2.height(), bRect2.width());
00897     }
00898     <span class="keywordtype">int</span> maxDist = 0;
00899 
00900     <span class="keywordflow">for</span> (uint i = 1; i &lt; d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>(); i++ )
00901     {
00902         bRect1 = bRect2;
00903         bRect2 = <a class="code" href="class_qwt_scale_draw.html#b3">labelBoundingRect</a>(fm, d_scldiv.<a class="code" href="class_qwt_scale_div.html#a8">majMark</a>(i));
00904         <span class="keywordflow">if</span> ( vertical )
00905         {
00906             bRect2.setRect(-bRect2.bottom(), 0,
00907                 bRect2.height(), bRect2.width());
00908         }
00909 
00910         <span class="keywordtype">int</span> dist = fm.leading(); <span class="comment">// space between the labels</span>
00911         <span class="keywordflow">if</span> ( bRect1.right() &gt; 0 )
00912             dist += bRect1.right();
00913         <span class="keywordflow">if</span> ( bRect2.left() &lt; 0 )
00914             dist += -bRect2.left();
00915 
00916         <span class="keywordflow">if</span> ( dist &gt; maxDist )
00917             maxDist = dist;
00918     }
00919 
00920     <span class="keywordtype">double</span> angle = d_labelRotation / 180.0 * M_PI;
00921     <span class="keywordflow">if</span> ( vertical )
00922         angle += M_PI / 2;
00923 
00924     <span class="keywordflow">if</span> ( sin(angle) == 0.0 )
00925         <span class="keywordflow">return</span> maxDist;
00926 
00927     <span class="keyword">const</span> <span class="keywordtype">int</span> fmHeight = fm.ascent() - 2; 
00928 
00929     <span class="comment">// The distance we need until there is</span>
00930     <span class="comment">// the height of the label font. This height is needed</span>
00931     <span class="comment">// for the neighbour labal.</span>
00932 
00933     <span class="keywordtype">int</span> labelDist = (int)(fmHeight / sin(angle) * cos(angle));
00934     <span class="keywordflow">if</span> ( labelDist &lt; 0 )
00935         labelDist = -labelDist;
00936 
00937     <span class="comment">// The cast above floored labelDist. We want to ceil.</span>
00938     labelDist++; 
00939 
00940     <span class="comment">// For text orientations close to the scale orientation </span>
00941 
00942     <span class="keywordflow">if</span> ( labelDist &gt; maxDist )
00943         labelDist = maxDist;
00944 
00945     <span class="comment">// For text orientations close to the opposite of the </span>
00946     <span class="comment">// scale orientation</span>
00947 
00948     <span class="keywordflow">if</span> ( labelDist &lt; fmHeight )
00949         labelDist = fmHeight;
00950 
00951     <span class="keywordflow">return</span> labelDist;
00952 }
00953 
<a name="l00960"></a><a class="code" href="class_qwt_scale_draw.html#a22">00960</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a22">QwtScaleDraw::minHeight</a>( <span class="keyword">const</span> QPen &amp;pen, <span class="keyword">const</span> QFontMetrics &amp;fm )<span class="keyword"> const</span>
00961 <span class="keyword"></span>{
00962     <span class="keyword">const</span> <span class="keywordtype">int</span> pw = QMAX( 1, pen.width() );  <span class="comment">// penwidth can be zero</span>
00963 
00964     <span class="keywordtype">int</span> h = 0;
00965     <span class="keywordflow">switch</span> ( d_orient )
00966     {
00967         <span class="keywordflow">case</span> Left:
00968         <span class="keywordflow">case</span> Right:
00969         {
00970             <span class="keywordtype">int</span> bottomDist, topDist;
00971             <a class="code" href="class_qwt_scale_draw.html#a20">minBorderDist</a>(fm, bottomDist, topDist);
00972 
00973             h = bottomDist + topDist;
00974             <span class="keywordflow">if</span> ( d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() &gt;= 2 ) 
00975                 h += <a class="code" href="class_qwt_scale_draw.html#a21">minLabelDist</a>(fm) * (d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() - 1);
00976 
00977             <span class="keywordtype">int</span> th = 2 * (d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() + d_scldiv.<a class="code" href="class_qwt_scale_div.html#a5">minCnt</a>()) * pw;
00978             <span class="keywordflow">if</span> ( th &gt; h )
00979                 h = th;
00980             <span class="keywordflow">break</span>;
00981         }
00982         <span class="keywordflow">case</span> Round:
00983             <span class="comment">// compute the radial thickness</span>
00984             h = pw + d_vpad + d_majLen + <a class="code" href="class_qwt_scale_draw.html#b2">maxLabelWidth</a>(fm);
00985             <span class="keywordflow">break</span>;
00986         <span class="keywordflow">case</span> Top:
00987         <span class="keywordflow">case</span> Bottom:
00988             h = pw + d_vpad + d_majLen + <a class="code" href="class_qwt_scale_draw.html#b1">maxLabelHeight</a>(fm);
00989             <span class="keywordflow">break</span>;
00990     }
00991     <span class="keywordflow">return</span> h;
00992 }
00993 
<a name="l01000"></a><a class="code" href="class_qwt_scale_draw.html#a23">01000</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a23">QwtScaleDraw::minWidth</a>( <span class="keyword">const</span> QPen &amp;pen, <span class="keyword">const</span> QFontMetrics &amp;fm )<span class="keyword"> const</span>
01001 <span class="keyword"></span>{
01002     <span class="keyword">const</span> <span class="keywordtype">int</span> pw = QMAX( 1, pen.width() );  <span class="comment">// penwidth can be zero</span>
01003 
01004     <span class="keywordtype">int</span> w = 0;
01005 
01006     <span class="keywordflow">switch</span>(d_orient)
01007     {
01008         <span class="keywordflow">case</span> Left:
01009         <span class="keywordflow">case</span> Right:
01010         {
01011             w = pw + d_hpad + d_majLen + <a class="code" href="class_qwt_scale_draw.html#b2">maxLabelWidth</a>(fm);
01012             <span class="keywordflow">break</span>;
01013         }
01014         <span class="keywordflow">case</span> Round:
01015         {   
01016             w = pw + d_vpad + d_majLen + <a class="code" href="class_qwt_scale_draw.html#b2">maxLabelWidth</a>(fm);
01017             <span class="keywordflow">break</span>;
01018         }
01019         <span class="keywordflow">case</span> Top:
01020         <span class="keywordflow">case</span> Bottom:
01021         {
01022             <span class="keywordtype">int</span> leftDist, rightDist;
01023             <a class="code" href="class_qwt_scale_draw.html#a20">minBorderDist</a>(fm, leftDist, rightDist);
01024 
01025             w = leftDist + rightDist + 
01026                 <a class="code" href="class_qwt_scale_draw.html#a21">minLabelDist</a>(fm) * (d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() - 1);
01027 
01028             <span class="keywordtype">int</span> tw = 2 * (d_scldiv.<a class="code" href="class_qwt_scale_div.html#a6">majCnt</a>() + d_scldiv.<a class="code" href="class_qwt_scale_div.html#a5">minCnt</a>()) * pw;
01029             <span class="keywordflow">if</span> ( tw &gt; w )
01030                 w = tw;
01031 
01032             <span class="keywordflow">break</span>;
01033         }
01034     }
01035     <span class="keywordflow">return</span> w;
01036 }
01037 
<a name="l01045"></a><a class="code" href="class_qwt_scale_draw.html#a30">01045</a> QString <a class="code" href="class_qwt_scale_draw.html#a30">QwtScaleDraw::label</a>(<span class="keywordtype">double</span> value)<span class="keyword"> const</span>
01046 <span class="keyword"></span>{
01047 <span class="preprocessor">#if 1</span>
01048 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( value == -0 )
01049         value = 0;
01050 <span class="preprocessor">#endif</span>
01051 <span class="preprocessor"></span>
01052     <span class="comment">// snprintf is C99 and therefore not portable :-(</span>
01053     <span class="comment">// sprintf is safe, when buffer is large enough for</span>
01054     <span class="comment">// a minus sign, 99 digits, a radix symbol,</span>
01055     <span class="comment">// an exponent character, a minus or plus sign, 3 digits,</span>
01056     <span class="comment">// and a '\0'.</span>
01057     <span class="keywordtype">char</span> buffer[128];
01058     sprintf(buffer, d_formatBuffer, value);
01059 
01060     <span class="keywordflow">return</span> QString::fromLatin1(buffer);
01061 }
01062 
<a name="l01064"></a><a class="code" href="class_qwt_scale_draw.html#a7">01064</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a7">QwtScaleDraw::x</a>()<span class="keyword"> const</span>
01065 <span class="keyword"></span>{
01066     <span class="keywordflow">return</span> d_xorg;
01067 }
01068 
<a name="l01070"></a><a class="code" href="class_qwt_scale_draw.html#a8">01070</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a8">QwtScaleDraw::y</a>()<span class="keyword"> const</span>
01071 <span class="keyword"></span>{
01072     <span class="keywordflow">return</span> d_yorg;
01073 }
01074 
<a name="l01076"></a><a class="code" href="class_qwt_scale_draw.html#a9">01076</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_scale_draw.html#a9">QwtScaleDraw::length</a>()<span class="keyword"> const</span>
01077 <span class="keyword"></span>{
01078     <span class="keywordflow">return</span> d_len;
01079 }
01080 
<a name="l01082"></a><a class="code" href="class_qwt_scale_draw.html#a10">01082</a> <a class="code" href="class_qwt_scale_draw.html#w7">QwtScaleDraw::Orientation</a> <a class="code" href="class_qwt_scale_draw.html#a10">QwtScaleDraw::orientation</a>()<span class="keyword"> const </span>
01083 <span class="keyword"></span>{ 
01084     <span class="keywordflow">return</span> d_orient; 
01085 }
01086 
01087 <span class="comment">// Local Variables:</span>
01088 <span class="comment">// mode: C++</span>
01089 <span class="comment">// c-file-style: "stroustrup"</span>
01090 <span class="comment">// indent-tabs-mode: nil</span>
01091 <span class="comment">// End:</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Nov 20 13:42:38 2004 for Qwt User's Guide by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
