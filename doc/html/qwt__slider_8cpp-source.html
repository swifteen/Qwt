<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Qwt User&apos;s Guide: qwt_slider.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>qwt_slider.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/* -*- mode: C++ ; c-file-style: "stroustrup" -*- *****************************</span>
00002 <span class="comment"> * Qwt Widget Library</span>
00003 <span class="comment"> * Copyright (C) 1997   Josef Wilgen</span>
00004 <span class="comment"> * Copyright (C) 2002   Uwe Rathmann</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
00007 <span class="comment"> * modify it under the terms of the Qwt License, Version 1.0</span>
00008 <span class="comment"> *****************************************************************************/</span>
00009 
00010 <span class="comment">// vim: expandtab</span>
00011 
00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
00013 <span class="preprocessor">#include &lt;qstyle.h&gt;</span>
00014 <span class="preprocessor">#include &lt;qevent.h&gt;</span>
00015 <span class="preprocessor">#include &lt;qdrawutil.h&gt;</span>
00016 <span class="preprocessor">#include &lt;qpainter.h&gt;</span>
00017 <span class="preprocessor">#include "qwt_paint_buffer.h"</span>
00018 <span class="preprocessor">#include "qwt_slider.h"</span>
00019 
<a name="l00040"></a><a class="code" href="class_qwt_slider.html#a0">00040</a> <a class="code" href="class_qwt_slider.html#a0">QwtSlider::QwtSlider</a>(QWidget *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00041         Qt::Orientation orient, ScalePos scalePos, BGSTYLE bgStyle): 
00042     <a class="code" href="class_qwt_slider_base.html">QwtSliderBase</a>(orient, parent, name, Qt::WRepaintNoErase|Qt::WResizeNoErase)
00043 {
00044     d_borderWidth = 2;
00045     d_scaleDist = 4;
00046     d_scalePos = scalePos;
00047     d_xMargin = 0;
00048     d_yMargin = 0;
00049     d_bgStyle = bgStyle;
00050 
00051     <span class="keywordflow">if</span> (bgStyle == BgSlot)
00052     {
00053         d_thumbLength = 16;
00054         d_thumbWidth = 30;
00055     }
00056     <span class="keywordflow">else</span>
00057     {
00058         d_thumbLength = 31;
00059         d_thumbWidth = 16;
00060     }
00061 
00062     d_sliderRect.setRect(0,0,8,8);
00063 
00064     QwtScaleDraw::Orientation so;
00065     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Vertical )
00066     {
00067         <span class="comment">// enforce a valid combination of scale position and orientation</span>
00068         <span class="keywordflow">if</span> ((d_scalePos == Bottom) || (d_scalePos == Top))
00069             d_scalePos = None;
00070         <span class="comment">// adopt the policy of layoutSlider (None lays out like Left)</span>
00071         <span class="keywordflow">if</span> (d_scalePos == Right)
00072            so = QwtScaleDraw::Right;
00073         <span class="keywordflow">else</span>
00074            so = QwtScaleDraw::Left;
00075     }
00076     <span class="keywordflow">else</span>
00077     {
00078         <span class="comment">// enforce a valid combination of scale position and orientation</span>
00079         <span class="keywordflow">if</span> ((d_scalePos == Left) || (d_scalePos == Right))
00080             d_scalePos = None;
00081         <span class="comment">// adopt the policy of layoutSlider (None lays out like Bottom)</span>
00082         <span class="keywordflow">if</span> (d_scalePos == Top)
00083            so = QwtScaleDraw::Top;
00084         <span class="keywordflow">else</span>
00085            so = QwtScaleDraw::Bottom;
00086     }
00087 
00088     <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(0,0,100,so);
00089 }
00090 
<a name="l00099"></a><a class="code" href="class_qwt_slider.html#a1">00099</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#a1">QwtSlider::setOrientation</a>(Qt::Orientation o) 
00100 {
00101     <span class="keywordflow">if</span> (o == Qt::Horizontal)
00102     {
00103         <span class="keywordflow">if</span> ((d_scalePos == Left) || (d_scalePos == Right))
00104             d_scalePos = None;
00105     }
00106     <span class="keywordflow">else</span> <span class="comment">// if (o == Qt::Vertical)</span>
00107     {
00108         <span class="keywordflow">if</span> ((d_scalePos == Bottom) || (d_scalePos == Top))
00109             d_scalePos = None;
00110     }
00111     <a class="code" href="class_qwt_slider_base.html#a7">QwtSliderBase::setOrientation</a>(o);
00112     <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00113 }
00114 
<a name="l00127"></a><a class="code" href="class_qwt_slider.html#a6">00127</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#a6">QwtSlider::setScalePosition</a>(ScalePos s)
00128 {
00129     d_scalePos = s;
00130     <span class="keywordflow">if</span> ((s == Bottom) || (s == Top))
00131         <a class="code" href="class_qwt_slider.html#a1">setOrientation</a>(Qt::Horizontal);
00132     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((s == Left) || (s == Right))
00133         <a class="code" href="class_qwt_slider.html#a1">setOrientation</a>(Qt::Vertical);
00134     <span class="keywordflow">else</span>
00135         <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00136 }
00137 
<a name="l00139"></a><a class="code" href="class_qwt_slider.html#a7">00139</a> <a class="code" href="class_qwt_slider.html#w8">QwtSlider::ScalePos</a> <a class="code" href="class_qwt_slider.html#a7">QwtSlider::scalePosition</a>()<span class="keyword"> const</span>
00140 <span class="keyword"></span>{
00141     <span class="keywordflow">return</span> d_scalePos;
00142 }
00143 
<a name="l00148"></a><a class="code" href="class_qwt_slider.html#a13">00148</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#a13">QwtSlider::setBorderWidth</a>(<span class="keywordtype">int</span> bd)
00149 {
00150     <span class="keywordflow">if</span> ( bd &lt; 0 )
00151         bd = 0;
00152 
00153     <span class="keywordflow">if</span> ( bd != d_borderWidth )
00154     {
00155         d_borderWidth = bd;
00156         <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00157     }
00158 }
00159 
<a name="l00164"></a><a class="code" href="class_qwt_slider.html#a11">00164</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#a11">QwtSlider::setThumbLength</a>(<span class="keywordtype">int</span> thumbLength)
00165 {
00166     <span class="keywordflow">if</span> ( thumbLength &lt; 8 )
00167         thumbLength = 8;
00168 
00169     <span class="keywordflow">if</span> ( thumbLength != d_thumbLength )
00170     {
00171         d_thumbLength = thumbLength;
00172         <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00173     }
00174 }
00175 
<a name="l00180"></a><a class="code" href="class_qwt_slider.html#a12">00180</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#a12">QwtSlider::setThumbWidth</a>(<span class="keywordtype">int</span> w)
00181 {
00182     <span class="keywordflow">if</span> ( w &lt; 4 )
00183         w = 4;
00184 
00185     <span class="keywordflow">if</span> ( d_thumbWidth != w )
00186     {
00187         d_thumbWidth = w;
00188         <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00189     }
00190 }
00191 
00192 
<a name="l00194"></a><a class="code" href="class_qwt_slider.html#b9">00194</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b9">QwtSlider::scaleChange</a>()
00195 {
00196     <span class="keywordflow">if</span> (!<a class="code" href="class_qwt_scale_if.html#b0">hasUserScale</a>())
00197     {
00198         <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a2">setScale</a>(<a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>(), <a class="code" href="class_qwt_dbl_range.html#a11">maxValue</a>(), 
00199             <a class="code" href="class_qwt_scale_if.html#a9">scaleMaxMajor</a>(), <a class="code" href="class_qwt_scale_if.html#a8">scaleMaxMinor</a>(),
00200             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;scaleDiv().logScale());
00201     }
00202 
00203     <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00204 }
00205 
00206 
<a name="l00208"></a><a class="code" href="class_qwt_slider.html#b10">00208</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b10">QwtSlider::fontChange</a>(<span class="keyword">const</span> QFont &amp;f)
00209 {
00210     QwtSliderBase::fontChange( f );
00211     <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00212 }
00213 
<a name="l00215"></a><a class="code" href="class_qwt_slider.html#b3">00215</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b3">QwtSlider::drawSlider</a>(QPainter *p, <span class="keyword">const</span> QRect &amp;r)
00216 {
00217     QRect cr(r);
00218 
00219     <span class="keywordflow">if</span> (d_bgStyle &amp; BgTrough)
00220     {
00221         qDrawShadePanel(p, r.x(), r.y(),
00222             r.width(), r.height(),
00223             colorGroup(), TRUE, d_borderWidth,0);
00224 
00225         cr.setRect(r.x() + d_borderWidth,
00226             r.y() + d_borderWidth,
00227             r.width() - 2 * d_borderWidth,
00228             r.height() - 2 * d_borderWidth);
00229 
00230         p-&gt;fillRect(cr.x(), cr.y(), cr.width(), cr.height(), 
00231             colorGroup().brush(QColorGroup::Mid));
00232     }
00233 
00234     <span class="keywordflow">if</span> ( d_bgStyle &amp; BgSlot)
00235     {
00236         <span class="keywordtype">int</span> ws = 4;
00237         <span class="keywordtype">int</span> ds = d_thumbLength / 2 - 4;
00238         <span class="keywordflow">if</span> ( ds &lt; 1 )
00239             ds = 1;
00240 
00241         QRect rSlot;
00242         <span class="keywordflow">if</span> (<a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal)
00243         {
00244             <span class="keywordflow">if</span> ( cr.height() &amp; 1 )
00245                 ws++;
00246             rSlot = QRect(cr.x() + ds, 
00247                     cr.y() + (cr.height() - ws) / 2,
00248                     cr.width() - 2 * ds, ws);
00249         }
00250         <span class="keywordflow">else</span>
00251         {
00252             <span class="keywordflow">if</span> ( cr.width() &amp; 1 )
00253                 ws++;
00254             rSlot = QRect(cr.x() + (cr.width() - ws) / 2, 
00255                     cr.y() + ds,
00256                     ws, cr.height() - 2 * ds);
00257         }
00258         p-&gt;fillRect(rSlot.x(), rSlot.y(), rSlot.width(), rSlot.height(),
00259             colorGroup().brush(QColorGroup::Dark));
00260         qDrawShadePanel(p, rSlot.x(), rSlot.y(),
00261             rSlot.width(), rSlot.height(), colorGroup(), TRUE, 1 ,0);
00262 
00263     }
00264 
00265     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_slider_base.html#a10">isValid</a>() )
00266         <a class="code" href="class_qwt_slider.html#b4">drawThumb</a>(p, cr, <a class="code" href="class_qwt_slider.html#b12">xyPosition</a>(<a class="code" href="class_qwt_dbl_range.html#a6">value</a>()));
00267 }
00268 
<a name="l00270"></a><a class="code" href="class_qwt_slider.html#b4">00270</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b4">QwtSlider::drawThumb</a>(QPainter *p, <span class="keyword">const</span> QRect &amp;sliderRect, <span class="keywordtype">int</span> pos)
00271 {
00272     pos++; <span class="comment">// shade line points one pixel below</span>
00273     <span class="keywordflow">if</span> (<a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal)
00274     {
00275         qDrawShadePanel(p, pos - d_thumbLength / 2, 
00276             sliderRect.y(), d_thumbLength, sliderRect.height(),
00277             colorGroup(), FALSE, d_borderWidth, 
00278             &amp;colorGroup().brush(QColorGroup::Button));
00279 
00280         qDrawShadeLine(p, pos, sliderRect.y(), 
00281             pos, sliderRect.y() + sliderRect.height() - 2, 
00282             colorGroup(), TRUE, 1);
00283     }
00284     <span class="keywordflow">else</span> <span class="comment">// Vertical</span>
00285     {
00286         qDrawShadePanel(p,sliderRect.x(), pos - d_thumbLength / 2, 
00287             sliderRect.width(), d_thumbLength,
00288             colorGroup(),FALSE, d_borderWidth, 
00289             &amp;colorGroup().brush(QColorGroup::Button));
00290 
00291         qDrawShadeLine(p, sliderRect.x(), pos,
00292             sliderRect.x() + sliderRect.width() - 2, pos, 
00293             colorGroup(), TRUE, 1);
00294     }
00295 }
00296 
<a name="l00298"></a><a class="code" href="class_qwt_slider.html#b12">00298</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_slider.html#b12">QwtSlider::xyPosition</a>(<span class="keywordtype">double</span> v)<span class="keyword"> const</span>
00299 <span class="keyword"></span>{
00300     <span class="keywordtype">int</span> pos;
00301     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>() == <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a11">d1</a>() &amp;&amp; <a class="code" href="class_qwt_dbl_range.html#a11">maxValue</a>() == <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a12">d2</a>() )
00302     {
00303         <span class="comment">// We prefer to use the transformation of scaleDraw</span>
00304         <span class="comment">// So ticks and marker are always in sync and we don't have</span>
00305         <span class="comment">// to take care of rounding problems.</span>
00306 
00307         pos = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a7">transform</a>(v);
00308     }
00309     <span class="keywordflow">else</span>
00310     {
00311         <span class="comment">// range and scaleDraw differ ? Sounds strange but</span>
00312         <span class="comment">// might happen with logarithmic scales</span>
00313 
00314         <span class="keyword">const</span> <span class="keywordtype">double</span> f = (v - <a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>()) / (<a class="code" href="class_qwt_dbl_range.html#a11">maxValue</a>() - <a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>());
00315         <span class="keywordtype">double</span> dPos;
00316         <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal )
00317             dPos = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>() + f * (<a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a14">i2</a>() - <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>());
00318         <span class="keywordflow">else</span>
00319             dPos = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>() - f * (<a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>() - <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a14">i2</a>());
00320         pos = qRound(dPos);
00321     }
00322     <span class="keywordflow">return</span> pos;
00323 }
00324 
<a name="l00326"></a><a class="code" href="class_qwt_slider.html#b0">00326</a> <span class="keywordtype">double</span> <a class="code" href="class_qwt_slider.html#b0">QwtSlider::getValue</a>(<span class="keyword">const</span> QPoint &amp;p)
00327 {
00328     <span class="keywordtype">double</span> rv;
00329 
00330     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>() == <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a11">d1</a>() &amp;&amp; <a class="code" href="class_qwt_dbl_range.html#a11">maxValue</a>() == <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a12">d2</a>() )
00331     {
00332         rv = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a8">invTransform</a>(
00333             <a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal ? p.x() : p.<a class="code" href="class_qwt_scale_draw.html#a8">y</a>());
00334     }
00335     <span class="keywordflow">else</span>
00336     {
00337         <span class="keywordtype">double</span> pos;
00338         <span class="keywordtype">double</span> range;
00339         <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal )
00340         {
00341             pos = p.<a class="code" href="class_qwt_scale_draw.html#a7">x</a>() - <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>();
00342             range = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a14">i2</a>() - <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>();
00343         }
00344         <span class="keywordflow">else</span>
00345         {
00346             pos = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>() - p.<a class="code" href="class_qwt_scale_draw.html#a8">y</a>();
00347             range = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>() - <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a14">i2</a>();
00348         }
00349             
00350         rv = <a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>() + pos / range * (<a class="code" href="class_qwt_dbl_range.html#a11">maxValue</a>() - <a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>()); 
00351     }
00352 
00353     <span class="keywordflow">return</span>(rv);
00354 }
00355 
00356 
<a name="l00363"></a><a class="code" href="class_qwt_slider.html#b1">00363</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b1">QwtSlider::getScrollMode</a>(<span class="keyword">const</span> QPoint &amp;p, 
00364     <span class="keywordtype">int</span> &amp;scrollMode, <span class="keywordtype">int</span> &amp;direction )
00365 {
00366     <span class="keywordflow">if</span> (!d_sliderRect.contains(p))
00367     {
00368         scrollMode = ScrNone;
00369         direction = 0;
00370         <span class="keywordflow">return</span>;
00371     }
00372 
00373     <span class="keyword">const</span> <span class="keywordtype">int</span> pos = ( <a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal ) ? p.<a class="code" href="class_qwt_scale_draw.html#a7">x</a>() : p.<a class="code" href="class_qwt_scale_draw.html#a8">y</a>();
00374     <span class="keyword">const</span> <span class="keywordtype">int</span> markerPos = <a class="code" href="class_qwt_slider.html#b12">xyPosition</a>(<a class="code" href="class_qwt_dbl_range.html#a6">value</a>());
00375 
00376     <span class="keywordflow">if</span> ((pos &gt; markerPos - d_thumbLength / 2)
00377         &amp;&amp; (pos &lt; markerPos + d_thumbLength / 2))
00378     {
00379         scrollMode = ScrMouse;
00380         direction = 0;
00381         <span class="keywordflow">return</span>;
00382     }
00383 
00384     scrollMode = ScrPage;
00385     direction = (pos &gt; markerPos) ? 1 : -1;
00386     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a13">i1</a>() &gt; <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a14">i2</a>() )
00387         direction = -direction;
00388 }
00389 
<a name="l00391"></a><a class="code" href="class_qwt_slider.html#b6">00391</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b6">QwtSlider::paintEvent</a>(QPaintEvent *e)
00392 {
00393     <span class="keyword">const</span> QRect &amp;ur = e-&gt;rect();
00394     <span class="keywordflow">if</span> ( ur.isValid() )
00395     {
00396         <a class="code" href="class_qwt_paint_buffer.html">QwtPaintBuffer</a> paintBuffer(<span class="keyword">this</span>, ur);
00397         <a class="code" href="class_qwt_slider.html#b2">draw</a>(paintBuffer.<a class="code" href="class_qwt_paint_buffer.html#a5">painter</a>(), ur);
00398     }
00399 }
00400 
<a name="l00402"></a><a class="code" href="class_qwt_slider.html#b2">00402</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b2">QwtSlider::draw</a>(QPainter *painter, <span class="keyword">const</span> QRect&amp;)
00403 {
00404     <span class="keywordflow">if</span> (d_scalePos != None)
00405         <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a29">draw</a>(painter);
00406 
00407     <a class="code" href="class_qwt_slider.html#b3">drawSlider</a>(painter, d_sliderRect);
00408     <span class="keywordflow">if</span> ( hasFocus() )
00409     {
00410         <span class="keyword">const</span> QRect rect = d_sliderRect;
00411 
00412 <span class="preprocessor">#if QT_VERSION &lt; 300</span>
00413 <span class="preprocessor"></span>        style().drawFocusRect(painter, rect, colorGroup());
00414 <span class="preprocessor">#else</span>
00415 <span class="preprocessor"></span>        style().drawPrimitive(QStyle::PE_FocusRect, painter,
00416             rect, colorGroup());
00417 <span class="preprocessor">#endif</span>
00418 <span class="preprocessor"></span>    }
00419 }
00420 
<a name="l00422"></a><a class="code" href="class_qwt_slider.html#b5">00422</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b5">QwtSlider::resizeEvent</a>(QResizeEvent *)
00423 {
00424     <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>( FALSE );
00425 }
00426 
<a name="l00433"></a><a class="code" href="class_qwt_slider.html#b11">00433</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b11">QwtSlider::layoutSlider</a>( <span class="keywordtype">bool</span> update_geometry )
00434 {
00435     <span class="keywordtype">int</span> sliderWidth = d_thumbWidth;
00436     <span class="keywordtype">int</span> sld1 = d_thumbLength / 2 - 1;
00437     <span class="keywordtype">int</span> sld2 = d_thumbLength / 2 + d_thumbLength % 2;
00438     <span class="keywordflow">if</span> ( d_bgStyle &amp; BgTrough )
00439     {
00440         sliderWidth += 2 * d_borderWidth;
00441         sld1 += d_borderWidth;
00442         sld2 += d_borderWidth;
00443     }
00444 
00445     <span class="keywordtype">int</span> scd = 0;
00446     <span class="keywordflow">if</span> ( d_scalePos != None )
00447     {
00448         <span class="keywordtype">int</span> d1, d2;
00449         <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a20">minBorderDist</a>(fontMetrics(), d1, d2);
00450         scd = QMAX(d1, d2);
00451     }
00452 
00453     <span class="keywordtype">int</span> slo = scd - sld1;
00454     <span class="keywordflow">if</span> ( slo &lt; 0 )
00455         slo = 0;
00456 
00457     <span class="keyword">const</span> QRect r = rect();
00458     <span class="keywordflow">if</span> (<a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal)
00459     {
00460         <span class="keywordflow">switch</span> (d_scalePos)
00461         {
00462         <span class="keywordflow">case</span> Top:
00463             d_sliderRect.setRect(
00464     r.x() + d_xMargin + slo,
00465                 r.y() + r.height() -
00466                 d_yMargin - sliderWidth,
00467                 r.width() - 2 * d_xMargin - 2 * slo,
00468                 sliderWidth);
00469             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(
00470     d_sliderRect.x() + sld1,
00471                 d_sliderRect.y() - d_scaleDist,
00472                 d_sliderRect.width() - sld1 - sld2,
00473                 QwtScaleDraw::Top);
00474             <span class="keywordflow">break</span>;
00475 
00476         <span class="keywordflow">case</span> Bottom:
00477             d_sliderRect.setRect(
00478     r.x() + d_xMargin + slo,
00479                 r.y() + d_yMargin,
00480                 r.width() - 2 * d_xMargin - 2 * slo,
00481                 sliderWidth);
00482             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(
00483                 d_sliderRect.x() + sld1,
00484                 d_sliderRect.y() + d_sliderRect.height() + d_scaleDist,
00485                 d_sliderRect.width() - sld1 - sld2,
00486                 QwtScaleDraw::Bottom);
00487             <span class="keywordflow">break</span>;
00488 
00489         <span class="keywordflow">case</span> None: <span class="comment">// like Bottom, but no scale. See QwtSlider().</span>
00490         <span class="keywordflow">default</span>:   <span class="comment">// inconsistent orientation and scale position</span>
00491             <span class="comment">// QwtScaleDraw is derived from QwtDiMap.</span>
00492             <span class="comment">// The map serves to transform between coordinates and doubles.</span>
00493             d_sliderRect.setRect(
00494                 r.x() + d_xMargin + slo,
00495                 r.y() + d_yMargin,
00496                 r.width() - 2 * d_xMargin - 2 * slo,
00497                 sliderWidth);
00498             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a5">setIntRange</a>(
00499                 d_sliderRect.x() + sld1,
00500                 d_sliderRect.x() + d_sliderRect.width() - sld2 - 1);
00501             <span class="keywordflow">break</span>;
00502         }
00503     }
00504     <span class="keywordflow">else</span> <span class="comment">// if (orientation() == Qt::Vertical</span>
00505     {
00506         <span class="keywordflow">switch</span> (d_scalePos)
00507         {
00508         <span class="keywordflow">case</span> Right:
00509             d_sliderRect.setRect(
00510     r.x() + d_xMargin,
00511                 r.y() + d_yMargin + slo,
00512                 sliderWidth,
00513                 r.height() - 2 * d_yMargin - 2 * slo);
00514             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(
00515     d_sliderRect.x() + d_sliderRect.width() + d_scaleDist,
00516                 d_sliderRect.y() + sld1,
00517                 d_sliderRect.height() - sld1 - sld2,
00518                 QwtScaleDraw::Right);
00519             <span class="keywordflow">break</span>;
00520 
00521         <span class="keywordflow">case</span> Left:
00522             d_sliderRect.setRect(
00523     r.x() + r.width() - sliderWidth - d_xMargin,
00524                 r.y() + d_yMargin + slo,
00525                 sliderWidth,
00526                 r.height() - 2 * d_yMargin - 2 * slo);
00527             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a6">setGeometry</a>(
00528     d_sliderRect.x() - d_scaleDist,
00529                 d_sliderRect.y() + sld1,
00530                 d_sliderRect.height() - sld1 - sld2,
00531                 QwtScaleDraw::Left);
00532             <span class="keywordflow">break</span>;
00533 
00534         <span class="keywordflow">case</span> None: <span class="comment">// like Left, but no scale. See QwtSlider().</span>
00535         <span class="keywordflow">default</span>:   <span class="comment">// inconsistent orientation and scale position</span>
00536             <span class="comment">// QwtScaleDraw is derived from QwtDiMap.</span>
00537             <span class="comment">// The map serves to transform between coordinates and doubles.</span>
00538             d_sliderRect.setRect(
00539                 r.x() + r.width() - sliderWidth - d_xMargin,
00540                 r.y() + d_yMargin + slo,
00541                 sliderWidth,
00542                 r.height() - 2 * d_yMargin - 2 * slo);
00543             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_di_map.html#a5">setIntRange</a>(
00544                 d_sliderRect.y() + d_sliderRect.height() - sld2 - 1,
00545                 d_sliderRect.y() + sld1);
00546             <span class="keywordflow">break</span>;
00547         }
00548     }
00549 
00550     <span class="keywordflow">if</span> ( update_geometry )
00551     {
00552         updateGeometry();
00553         update();
00554     }
00555 }
00556 
<a name="l00558"></a><a class="code" href="class_qwt_slider.html#b7">00558</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b7">QwtSlider::valueChange</a>()
00559 {
00560     <a class="code" href="class_qwt_slider_base.html#b1">QwtSliderBase::valueChange</a>();
00561     update();
00562 }
00563 
00564 
<a name="l00566"></a><a class="code" href="class_qwt_slider.html#b8">00566</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#b8">QwtSlider::rangeChange</a>()
00567 {
00568     <span class="keywordflow">if</span> (!<a class="code" href="class_qwt_scale_if.html#b0">hasUserScale</a>())
00569     {
00570         <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a2">setScale</a>(<a class="code" href="class_qwt_dbl_range.html#a12">minValue</a>(), <a class="code" href="class_qwt_dbl_range.html#a11">maxValue</a>(), 
00571             <a class="code" href="class_qwt_scale_if.html#a9">scaleMaxMajor</a>(), <a class="code" href="class_qwt_scale_if.html#a8">scaleMaxMinor</a>(),
00572             <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;scaleDiv().logScale());
00573     }
00574 
00575     <a class="code" href="class_qwt_dbl_range.html#b5">QwtSliderBase::rangeChange</a>();
00576     <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00577 }
00578 
<a name="l00584"></a><a class="code" href="class_qwt_slider.html#a14">00584</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_slider.html#a14">QwtSlider::setMargins</a>(<span class="keywordtype">int</span> xMargin, <span class="keywordtype">int</span> yMargin)
00585 {
00586     <span class="keywordflow">if</span> ( xMargin &lt; 0 )
00587         xMargin = 0;
00588     <span class="keywordflow">if</span> ( yMargin &lt; 0 )
00589         yMargin = 0;
00590 
00591     <span class="keywordflow">if</span> ( xMargin != d_xMargin || yMargin != d_yMargin )
00592     {
00593         d_xMargin = xMargin;
00594         d_yMargin = yMargin;
00595         <a class="code" href="class_qwt_slider.html#b11">layoutSlider</a>();
00596     }
00597 }
00598 
<a name="l00603"></a><a class="code" href="class_qwt_slider.html#a17">00603</a> QSizePolicy <a class="code" href="class_qwt_slider.html#a17">QwtSlider::sizePolicy</a>()<span class="keyword"> const</span>
00604 <span class="keyword"></span>{
00605     QSizePolicy sp;
00606     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Horizontal )
00607     {
00608         sp.setHorData( QSizePolicy::MinimumExpanding );
00609         sp.setVerData( QSizePolicy::Fixed );
00610     }
00611     <span class="keywordflow">else</span>
00612     {
00613         sp.setHorData( QSizePolicy::Fixed );
00614         sp.setVerData( QSizePolicy::MinimumExpanding );
00615     }
00616     <span class="keywordflow">return</span> sp;
00617 }
00618 
<a name="l00622"></a><a class="code" href="class_qwt_slider.html#a15">00622</a> QSize <a class="code" href="class_qwt_slider.html#a15">QwtSlider::sizeHint</a>()<span class="keyword"> const</span>
00623 <span class="keyword"></span>{
00624     <span class="keywordflow">return</span> <a class="code" href="class_qwt_slider.html#a16">minimumSizeHint</a>();
00625 }
00626 
<a name="l00632"></a><a class="code" href="class_qwt_slider.html#a16">00632</a> QSize <a class="code" href="class_qwt_slider.html#a16">QwtSlider::minimumSizeHint</a>()<span class="keyword"> const</span>
00633 <span class="keyword"></span>{
00634     <span class="keywordtype">int</span> w = 0, h = 0;
00635 
00636     <span class="keywordtype">int</span> sliderWidth = d_thumbWidth;
00637     <span class="keywordflow">if</span> (d_bgStyle &amp; BgTrough)
00638         sliderWidth += 2 * d_borderWidth;
00639 
00640     <span class="keywordflow">if</span> (d_scalePos != None)
00641     {
00642         <span class="keywordtype">int</span> msWidth = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a23">minWidth</a>( QPen(), fontMetrics() );
00643         <span class="keywordtype">int</span> msHeight = <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a22">minHeight</a>( QPen(), fontMetrics() );
00644         
00645         <span class="keywordtype">int</span> d1, d2;
00646         <a class="code" href="class_qwt_scale_if.html#a11">scaleDraw</a>()-&gt;<a class="code" href="class_qwt_scale_draw.html#a20">minBorderDist</a>(fontMetrics(), d1, d2);
00647         <span class="keywordtype">int</span> msMbd = QMAX(d1, d2);
00648 
00649         <span class="keywordtype">int</span> mbd = d_thumbLength / 2;
00650         <span class="keywordflow">if</span> (d_bgStyle &amp; BgTrough)
00651             mbd += d_borderWidth;
00652 
00653         <span class="keywordflow">if</span> ( mbd &lt; msMbd )
00654             mbd = msMbd;
00655 
00656         <span class="keywordflow">if</span> (<a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Vertical)
00657         {
00658             w = 2 * d_xMargin + sliderWidth + msWidth + d_scaleDist;
00659             h = msHeight - 2 * msMbd + 2 * mbd + 2 * d_yMargin;
00660         }
00661         <span class="keywordflow">else</span>
00662         {
00663             w = msWidth - 2 * msMbd + 2 * mbd + 2 * d_xMargin;
00664             h = 2 * d_yMargin + sliderWidth  + msHeight + d_scaleDist;
00665         }
00666     }
00667     <span class="keywordflow">else</span>  <span class="comment">// no scale</span>
00668     {
00669         <span class="keywordflow">if</span> (<a class="code" href="class_qwt_slider_base.html#a8">orientation</a>() == Qt::Vertical)
00670         {
00671             w = 2 * d_xMargin + sliderWidth;
00672             h = 200 + 2 * d_yMargin;
00673         }
00674         <span class="keywordflow">else</span>
00675         {
00676             w = 200 + 2 * d_xMargin;
00677             h = 2 * d_yMargin + sliderWidth;
00678         }
00679     }
00680     <span class="keywordflow">return</span> QSize(w,h);
00681 }
00682 
00683 <span class="comment">// Local Variables:</span>
00684 <span class="comment">// mode: C++</span>
00685 <span class="comment">// c-file-style: "stroustrup"</span>
00686 <span class="comment">// indent-tabs-mode: nil</span>
00687 <span class="comment">// End:</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Nov 20 13:42:38 2004 for Qwt User's Guide by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
